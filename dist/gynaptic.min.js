/*!
 * The MIT License (MIT)
 * 
 * Copyright for portions of Gynaptic are held by Copyright (c) 2016 Juan Cazala -
 * juancazala.com, as part of project Synaptic. All other copyright for project
 * Gynaptic are held by Copyright (c) 2017 Thomas Wagenaar.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE
 * 
 */
!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=9)}([function(t,e,n){(function(t){var e={};e.Connection={ALL_TO_ALL:"ALL TO ALL",ONE_TO_ONE:"ONE TO ONE",ALL_TO_ELSE:"ALL TO ELSE"},e.Cost={CROSS_ENTROPY:function(t,e){var n=0;for(var i in e)n-=t[i]*Math.log(e[i]+1e-15)+(1-t[i])*Math.log(1+1e-15-e[i]);return n},MSE:function(t,e){var n=0;for(var i in e)n+=Math.pow(t[i]-e[i],2);return n/e.length},BINARY:function(t,e){var n=0;for(var i in e)n+=Math.round(2*t[i])!=Math.round(2*e[i]);return n}},e.Squash={LOGISTIC:function(t,n){if(!n)return 1/(1+Math.exp(-t));var i=e.Squash.LOGISTIC(t);return i*(1-i)},TANH:function(t,n){return n?1-Math.pow(e.Squash.TANH(t),2):Math.tanh(t)},IDENTITY:function(t,e){return e?1:t},HLIM:function(t,e){return e?1:t>0?1:0},RELU:function(t,e){return e?t>0?1:0:t>0?t:0},SOFTSIGN:function(t,e){var n=1+Math.abs(t);return e?t/Math.pow(n,2):t/n},SINUSOID:function(t,e){return e?Math.cos(t):Math.sin(t)},GAUSSIAN:function(t,e){var n=Math.exp(-Math.pow(t,2));return e?-2*t*n:n}},e.Mutate={SWAP_WEIGHT:{name:"SWAP_WEIGHT"},SWAP_BIAS:{name:"SWAP_BIAS"},MODIFY_RANDOM_WEIGHT:{name:"MODIFY_RANDOM_WEIGHT",config:{min:-1,max:1}},MODIFY_RANDOM_BIAS:{name:"MODIFY_RANDOM_BIAS",config:{min:-1,max:1}},MODIFY_CONNECTIONS:{name:"MODIFY_CONNECTIONS"},MODIFY_NEURONS:{name:"MODIFY_NEURONS"},MODIFY_SQUASH:{name:"MODIFY_SQUASH",config:{allowed:[e.Squash.LOGISTIC,e.Squash.TANH,e.Squash.RELU,e.Squash.IDENTITY,e.Squash.HLIM,e.Squash.SOFTSIGN,e.Squash.SINUSOID,e.Squash.GAUSSIAN]}}},e.Crossover={SINGLE_POINT:{name:"SINGLE_POINT",config:[.4]},TWO_POINT:{name:"TWO_POINT",config:[.4,.9]},UNIFORM:{name:"UNIFORM"},AVERAGE:{name:"AVERAGE"}},e.Selection={FITNESS_PROPORTIONATE:{name:"FITNESS_PROPORTIONATE",config:function(t){return Math.pow(t,2)}}},e.Generation={POINTS:{name:"POINTS",config:{points:2,learningRate:.3,iterations:50,shuffle:!0,error:1e-4,cost:e.Cost.MSE}},DEFAULT:{name:"DEFAULT"}},e.Pooling={config:{size:[2,2]},MAX:{name:"MAX"},NONE:{name:"NONE"}},t&&(t.exports=e)}).call(e,n(1)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){(function(t){function e(t){for(this.size=0|t,this.list=[],this.connectedTo=[];t--;){var e=new i;this.list.push(e)}}t&&(t.exports=e);var i=n(4),o=n(3),r=n(0),s=r.Mutate,a=(r.Squash,r.Crossover),h=(r.Selection,r.Generation,r.Pooling,r.Cost,r.Connection);e.prototype={activate:function(t){var e=[];if(void 0!==t){if(t.length!=this.size)throw new Error("INPUT size and LAYER size must be the same to activate!");for(var n in this.list){var i=this.list[n],o=i.activate(t[n]);e.push(o)}}else for(var n in this.list){var i=this.list[n],o=i.activate();e.push(o)}return e},propagate:function(t,e){if(void 0!==e){if(e.length!=this.size)throw new Error("TARGET size and LAYER size must be the same to propagate!");for(var n=this.list.length-1;n>=0;n--){var i=this.list[n];i.propagate(t,e[n])}}else for(var n=this.list.length-1;n>=0;n--){var i=this.list[n];i.propagate(t)}},project:function(t,n,r){if(t instanceof o&&(t=t.layers.input),t instanceof e){if(!this.connected(t))return new e.connection(this,t,n,r)}else if(t instanceof i)for(var s in this.list)this.list[s].project(t)},gate:function(t,n){if(n==e.gateType.INPUT){if(t.to.size!=this.size)throw new Error("GATER layer and CONNECTION.TO layer must be the same size in order to gate!");for(var i in t.to.list){var o=t.to.list[i],r=this.list[i];for(var s in o.connections.inputs){var a=o.connections.inputs[s];a.ID in t.connections&&r.gate(a)}}}else if(n==e.gateType.OUTPUT){if(t.from.size!=this.size)throw new Error("GATER layer and CONNECTION.FROM layer must be the same size in order to gate!");for(var i in t.from.list){var o=t.from.list[i],r=this.list[i];for(var h in o.connections.projected){var a=o.connections.projected[h];a.ID in t.connections&&r.gate(a)}}}else if(n==e.gateType.ONE_TO_ONE){if(t.size!=this.size)throw new Error("The number of GATER UNITS must be the same as the number of CONNECTIONS to gate!");for(var i in t.list){var r=this.list[i],a=t.list[i];r.gate(a)}}t.gatedfrom.push({layer:this,type:n})},selfconnected:function(){for(var t in this.list){if(!this.list[t].selfconnected())return!1}return!0},disconnect:function(){for(var t in this.list)this.list[t].disconnect()},connected:function(t){var e=0;for(var n in this.list){var i=this.list[n];for(var o in t.list){var r=t.list[o],s=i.connected(r);"projected"==s.type&&e++}}if(e==this.size*t.size)return h.ALL_TO_ALL;e=0;for(var a in this.list){var i=this.list[a],r=t.list[a],s=i.connected(r);"projected"==s.type&&e++}return e==this.size?h.ONE_TO_ONE:void 0},clear:function(){for(var t in this.list){this.list[t].clear()}},reset:function(){for(var t in this.list){this.list[t].reset()}},neurons:function(){return this.list},connections:function(){var t={inputs:{},gated:{},projected:{}};for(var e in this.list)for(var n in this.list[e].connections)for(var i in this.list[e].connections[n])t[n][i]=this.list[e].connections[n][i];return t},add:function(t){this.neurons[t.ID]=t||new i,this.list.push(t),this.size++},set:function(t){t=t||{};for(var e in this.list){var n=this.list[e];t.squash&&(n.squash=t.squash),t.bias&&(n.bias=t.bias)}return this},mutate:function(t){switch(t=t||s.MODIFY_RANDOM_WEIGHT){case s.SWAP_WEIGHT:for(var e=Math.floor(Math.random()*this.list.length),n=Math.floor(Math.random()*this.list.length);n==e;)n=Math.floor(Math.random()*this.list.length);for(var i=this.list[e],o=this.list[n],r=Object.keys(i.connections),a=Object.keys(o.connections),h=2;h>=0;h--)0==Object.keys(i.connections[r[h]]).length&&r.splice(h,1),0==Object.keys(o.connections[a[h]]).length&&a.splice(h,1);r=r[Math.floor(Math.random()*r.length)];var c=Object.keys(i.connections[r]),u=c[Math.floor(Math.random()*c.length)];a=a[Math.floor(Math.random()*a.length)];var l=Object.keys(o.connections[a]),f=l[Math.floor(Math.random()*l.length)],p=i.connections[r][u].weight;i.connections[r][u].weight=o.connections[a][f].weight,o.connections[a][f].weight=p;break;case s.SWAP_BIAS:for(var e=Math.floor(Math.random()*this.list.length),n=Math.floor(Math.random()*this.list.length);n==e;)n=Math.floor(Math.random()*this.list.length);var p=this.list[e].bias;this.list[e].bias=this.list[n].bias,this.list[n].bias=p;break;case s.MODIFY_RANDOM_BIAS:var d=Math.floor(Math.random()*this.list.length),v=Math.random()*(s.MODIFY_RANDOM_BIAS.config.max-s.MODIFY_RANDOM_BIAS.config.min)+s.MODIFY_RANDOM_BIAS.config.min;this.list[d].bias+=v;break;case s.MODIFY_RANDOM_WEIGHT:for(var d=this.list[Math.floor(Math.random()*this.list.length)],g=Object.keys(d.connections),h=g.length-1;h>=0;h--)0==Object.keys(d.connections[g[h]]).length&&g.splice(h,1);g=g[Math.floor(Math.random()*g.length)];var M=Object.keys(d.connections[g]),m=M[Math.floor(Math.random()*M.length)],v=Math.random()*(s.MODIFY_RANDOM_WEIGHT.config.max-s.MODIFY_RANDOM_WEIGHT.config.min)+s.MODIFY_RANDOM_WEIGHT.config.min;d.connections[g][m].weight+=v;break;case s.MODIFY_SQUASH:for(var d=Math.floor(Math.random()*this.list.length),O=Math.floor(Math.random()*s.MODIFY_SQUASH.config.allowed.length);s.MODIFY_SQUASH.config.allowed[O]==this.list[d].squash;)O=Math.floor(Math.random()*s.MODIFY_SQUASH.config.allowed.length);this.list[d].squash=s.MODIFY_SQUASH.config.allowed[O]}},toJSON:function(){var t=this.list,e=[];for(var n in t){var i=t[n],o=i.toJSON();e.push(o)}return{neurons:e}}},e.crossOver=function(t,n,i){i=i||a.UNIFORM;var o=new e(t.list.length);switch(i){case a.UNIFORM:for(var r=0;r<o.list.length;r++)o.list[r].bias=Math.random()>=.5?t.list[r].bias:n.list[r].bias,o.list[r].squash=Math.random()>=.5?t.list[r].squash:n.list[r].squash;break;case a.AVERAGE:for(var r=0;r<o.list.length;r++)o.list[r].bias=(t.list[r].bias+n.list[r].bias)/2,o.list[r].squash=Math.random()>=.5?t.list[r].squash:n.list[r].squash;break;case a.SINGLE_POINT:for(var r=0;r<o.list.length;r++)r/o.list.length<a.SINGLE_POINT[0]?(o.list[r].bias=t.list[r].bias,o.list[r].squash=t.list[r].squash):(o.list[r].bias=n.list[r].bias,o.list[r].squash=n.list[r].squash);break;case a.TWO_POINT:for(var r=0;r<o.list.length;r++)r/o.list.length<a.SINGLE_POINT[0]||r/o.list.length>a.SINGLE_POINT[1]?(o.list[r].bias=t.list[r].bias,o.list[r].squash=t.list[r].squash):(o.list[r].bias=n.list[r].bias,o.list[r].squash=n.list[r].squash)}return o},e.fromJSON=function(t){var n=[];for(var o in t.neurons){var r=t.neurons[o],s=i.fromJSON(r);n.push(s)}var a=new e(n.length);return a.list=n,a},e.connection=function(t,n,i,o){if(this.ID=e.connection.uid(),this.from=t,this.to=n,this.selfconnection=n==t,this.type=i,this.connections={},this.list=[],this.size=0,this.gatedfrom=[],void 0===this.type&&(this.type=t==n?h.ONE_TO_ONE:h.ALL_TO_ALL),this.type==h.ALL_TO_ALL||this.type==h.ALL_TO_ELSE)for(var r in this.from.list)for(var s in this.to.list){var a=this.from.list[r],c=this.to.list[s];if(this.type!=h.ALL_TO_ELSE||a!=c){var u=a.project(c,o);this.connections[u.ID]=u,this.size=this.list.push(u)}}else if(this.type==h.ONE_TO_ONE)for(var l in this.from.list){var a=this.from.list[l],c=this.to.list[l],u=a.project(c,o);this.connections[u.ID]=u,this.size=this.list.push(u)}t.connectedTo.push(this)},e.gateType={},e.gateType.INPUT="INPUT",e.gateType.OUTPUT="OUTPUT",e.gateType.ONE_TO_ONE="ONE TO ONE",function(){var t=0;e.connection.uid=function(){return t++}}()}).call(e,n(1)(t))},function(t,e,n){(function(t){function e(t){void 0!==t&&(this.layers=t||{input:null,hidden:{},output:null},this.optimized=null)}t&&(t.exports=e);var i=n(4),o=n(2),r=n(5),s=n(0),a=s.Mutate,h=(s.Squash,s.Crossover),c=(s.Selection,s.Generation,s.Pooling,s.Cost);s.Connection;e.prototype={activate:function(t){if(this.optimized===!1){this.layers.input.activate(t);for(var e in this.layers.hidden)this.layers.hidden[e].activate();return this.layers.output.activate()}return null==this.optimized&&this.optimize(),this.optimized.activate(t)},propagate:function(t,e){if(this.optimized===!1){this.layers.output.propagate(t,e);var n=[];for(var i in this.layers.hidden)n.push(this.layers.hidden[i]);n.reverse();for(var i in n)n[i].propagate(t)}else null==this.optimized&&this.optimize(),this.optimized.propagate(t,e)},project:function(t,n,r){if(this.optimized&&this.optimized.reset(),t instanceof e)return this.layers.output.project(t.layers.input,n,r);if(t instanceof o)return this.layers.output.project(t,n,r);if(t instanceof i)return this.layers.output.project(t,n,r);throw new Error("Node must be a Neuron, Layer or Network")},disconnect:function(){this.layers.input.disconnect();for(var t in this.layers.hidden)this.layers.hidden[t].disconnect();this.layers.output.disconnect()},gate:function(t,e){this.optimized&&this.optimized.reset(),this.layers.output.gate(t,e)},clear:function(){this.restore();var t=this.layers.input,e=this.layers.output;t.clear();for(var n in this.layers.hidden)this.layers.hidden[n].clear();e.clear(),this.optimized&&this.optimized.reset()},reset:function(){this.restore();var t=this.layers.input,e=this.layers.output;t.reset();for(var n in this.layers.hidden){this.layers.hidden[n].reset()}e.reset(),this.optimized&&this.optimized.reset()},optimize:function(){var t=this,e={},n=this.neurons();for(var i in n){for(var o=n[i].neuron,r=n[i].layer;o.neuron;)o=o.neuron;e=o.optimize(e,r)}for(var i in e.propagation_sentences)e.propagation_sentences[i].reverse();e.propagation_sentences.reverse();var s="";s+="var F = Float64Array ? new Float64Array("+e.memory+") : []; ";for(var i in e.variables)s+="F["+e.variables[i].id+"] = "+(e.variables[i].value||0)+"; ";s+="var activate = function(input){\n";for(var i in e.inputs)s+="F["+e.inputs[i]+"] = input["+i+"]; ";for(var a in e.activation_sentences)if(e.activation_sentences[a].length>0)for(var h in e.activation_sentences[a])s+=e.activation_sentences[a][h].join(" "),s+=e.trace_sentences[a][h].join(" ");s+=" var output = []; ";for(var i in e.outputs)s+="output["+i+"] = F["+e.outputs[i]+"]; ";s+="return output; }; ",s+="var propagate = function(rate, target){\n",s+="F["+e.variables.rate.id+"] = rate; ";for(var i in e.targets)s+="F["+e.targets[i]+"] = target["+i+"]; ";for(var a in e.propagation_sentences)for(var h in e.propagation_sentences[a])s+=e.propagation_sentences[a][h].join(" ")+" ";s+=" };\n",s+="var ownership = function(memoryBuffer){\nF = memoryBuffer;\nthis.memory = F;\n};\n",s+="return {\nmemory: F,\nactivate: activate,\npropagate: propagate,\nownership: ownership\n};",s=s.split(";").join(";\n");var c=new Function(s),u=c();u.data={variables:e.variables,activate:e.activation_sentences,propagate:e.propagation_sentences,trace:e.trace_sentences,inputs:e.inputs,outputs:e.outputs,check_activation:this.activate,check_propagation:this.propagate},u.reset=function(){t.optimized&&(t.optimized=null,t.activate=u.data.check_activation,t.propagate=u.data.check_propagation)},this.optimized=u,this.activate=u.activate,this.propagate=u.propagate},restore:function(){if(this.optimized){var t=this.optimized,e=function(){var e=Array.prototype.slice.call(arguments),n=e.shift(),i=e.pop(),o=i+"_";for(var r in e)o+=e[r]+"_";o+=n.ID;var s=t.memory,a=t.data.variables;return o in a?s[a[o].id]:0},n=this.neurons();for(var i in n){for(var o=n[i].neuron;o.neuron;)o=o.neuron;o.state=e(o,"state"),o.old=e(o,"old"),o.activation=e(o,"activation"),o.bias=e(o,"bias");for(var r in o.trace.elegibility)o.trace.elegibility[r]=e(o,"trace","elegibility",r);for(var s in o.trace.extended)for(var r in o.trace.extended[s])o.trace.extended[s][r]=e(o,"trace","extended",s,r)}for(var i in n){for(var o=n[i].neuron;o.neuron;)o=o.neuron;for(var a in o.connections.projected){var h=o.connections.projected[a];h.weight=e(h,"weight"),h.gain=e(h,"gain")}}}},neurons:function(){var t=[],e=this.layers.input.neurons(),n=this.layers.output.neurons();for(var i in e)t.push({neuron:e[i],layer:"input"});for(var o in this.layers.hidden){var r=this.layers.hidden[o].neurons();for(var i in r)t.push({neuron:r[i],layer:o})}for(var i in n)t.push({neuron:n[i],layer:"output"});return t},connections:function(){var t=this.layers.input.connections();for(var e in this.layers.hidden)for(var n in this.layers.hidden[e].list)for(var i in this.layers.hidden[e].list[n].connections)for(var o in this.layers.hidden[e].list[n].connections[i])t[i][o]=this.layers.hidden[e].list[n].connections[i][o];for(var n in this.layers.output.list)for(var i in this.layers.output.list[n].connections)for(var o in this.layers.output.list[n].connections[i])t[i][o]=this.layers.output.list[n].connections[i][o];return t},inputs:function(){return this.layers.input.size},outputs:function(){return this.layers.output.size},set:function(t){this.layers=t,this.optimized&&this.optimized.reset()},setOptimize:function(t){this.restore(),this.optimized&&this.optimized.reset(),this.optimized=!!t&&null},mutate:function(t){switch(t=t||a.MODIFY_RANDOM_WEIGHT){case a.SWAP_WEIGHT:for(var e=Math.floor(Math.random()*this.neurons().length),n=Math.floor(Math.random()*this.neurons().length);n==e;)n=Math.floor(Math.random()*this.neurons().length);for(var o=this.neurons()[e].neuron,r=this.neurons()[n].neuron,s=Object.keys(o.connections),h=Object.keys(r.connections),c=2;c>=0;c--)0==Object.keys(o.connections[s[c]]).length&&s.splice(c,1),0==Object.keys(r.connections[h[c]]).length&&h.splice(c,1);s=s[Math.floor(Math.random()*s.length)];for(var u=Object.keys(o.connections[s]),l=u[Math.floor(Math.random()*u.length)],f=l;f==l;)var p=h[Math.floor(Math.random()*h.length)],d=Object.keys(r.connections[p]),f=d[Math.floor(Math.random()*d.length)];var v=o.connections[s][l].weight;o.connections[s][l].weight=r.connections[p][f].weight,r.connections[p][f].weight=v;break;case a.SWAP_BIAS:for(var e=Math.floor(Math.random()*(this.neurons().length-this.inputs())+this.inputs()),n=Math.floor(Math.random()*(this.neurons().length-this.inputs())+this.inputs());n==e;)n=Math.floor(Math.random()*this.neurons().length);var o=this.neurons()[e].neuron,r=this.neurons()[n].neuron,v=o.bias;o.bias=r.bias,r.bias=v;break;case a.MODIFY_RANDOM_BIAS:var g=Math.floor(Math.random()*(this.neurons().length-this.inputs())+this.inputs()),M=Math.random()*(a.MODIFY_RANDOM_BIAS.config.max-a.MODIFY_RANDOM_BIAS.config.min)+a.MODIFY_RANDOM_BIAS.config.min;this.neurons()[g].neuron.bias+=M;break;case a.MODIFY_RANDOM_WEIGHT:for(var g=Math.floor(Math.random()*this.neurons().length),g=this.neurons()[g].neuron,m=Object.keys(g.connections),c=m.length-1;c>=0;c--)0==Object.keys(g.connections[m[c]]).length&&m.splice(c,1);m=m[Math.floor(Math.random()*m.length)];var O=Object.keys(g.connections[m]),I=O[Math.floor(Math.random()*O.length)],M=Math.random()*(a.MODIFY_RANDOM_WEIGHT.config.max-a.MODIFY_RANDOM_WEIGHT.config.min)+a.MODIFY_RANDOM_WEIGHT.config.min;g.connections[m][I].weight+=M;break;case a.MODIFY_NEURONS:var y=Math.floor(this.layers.hidden.length*Math.random()),w=this.layers.hidden[y];if(Math.random()>=.5){var S=Math.floor(w.list.length*Math.random()),g=w.list[S];g.connections={},list=0==y?this.layers.input.list:this.layers.hidden[y-1].list;for(var b in list)for(var _ in list[b].connections.projected)list[b].connections.projected[_].to==g&&delete list[b].connections.projected[_];list=y==this.layers.hidden.length-1?this.layers.output.list:this.layers.hidden[y+1].list;for(var b in list)for(var _ in list[b].connections.inputs)list[b].connections.inputs[_].from==g&&delete list[b].connections.inputs[_];w.list.splice(S,1),w.size--}else{var g=new i;list=0==y?this.layers.input.list:this.layers.hidden[y-1].list;for(var b in list)list[b].project(g);list=y==this.layers.hidden.length-1?this.layers.output.list:this.layers.hidden[y+1].list;for(var b in this.layers.output.list)g.project(this.layers.output.list[b]);w.add(g)}break;case a.MODIFY_CONNECTIONS:if(Math.random()>=.5){for(var g;null==g||0==Object.keys(g.connections.inputs).length;)g=Math.floor(Math.random()*this.neurons().length),g=this.neurons()[g].neuron;var N=g.connections.inputs,T=Object.keys(N)[Math.floor(Object.keys(N).length*Math.random())],D=N[T].from.ID;delete N[T];for(var b in this.neurons())if(this.neurons()[b].neuron.ID==D){delete this.neurons()[b].neuron.connections.projected[T];break}if(0==Object.keys(N).length)for(var b in this.neurons()){var A=this.neurons()[b].neuron.connections.inputs,E=Object.keys(A);for(var _ in E)A[E[_]].from.ID==g.ID&&delete this.neurons()[b].neuron.connections.inputs[E[_]]}break}for(var o,r;null==r;){var e=Math.floor(Math.random()*(this.neurons().length-this.outputs())),z=Math.max(e+1,this.inputs()),n=Math.floor(Math.random()*(this.neurons().length-z)+z);o=this.neurons()[e].neuron,r=this.neurons()[n].neuron;for(var I in o.connections.projected)o.connections.projected[I].to==r&&(r=null)}o.project(r);break;case a.MODIFY_SQUASH:for(var g=Math.floor(Math.random()*(this.neurons().length-this.inputs())+this.inputs()),j=Math.floor(Math.random()*a.MODIFY_SQUASH.config.allowed.length);a.MODIFY_SQUASH.config.allowed[j]==this.neurons()[g].neuron.squash;)j=Math.floor(Math.random()*a.MODIFY_SQUASH.config.allowed.length);this.neurons()[g].neuron.squash=a.MODIFY_SQUASH.config.allowed[j]}},toJSON:function(t){this.restore();var e=this.neurons(),n=[],i=[],o={};for(var r in e){for(var s=e[r].neuron;s.neuron;)s=s.neuron;o[s.ID]=r;var a=s.toJSON();a.layer=e[r].layer,n.push(a)}for(var r in e){for(var s=e[r].neuron;s.neuron;)s=s.neuron;for(var h in s.connections.projected){var c=s.connections.projected[h];i.push({from:o[c.from.ID],to:o[c.to.ID],weight:c.weight,gater:c.gater?o[c.gater.ID]:null})}s.selfconnected()&&i.push({from:o[s.ID],to:o[s.ID],weight:s.selfconnection.weight,gater:s.selfconnection.gater?o[s.selfconnection.gater.ID]:null})}return{neurons:n,connections:i}},toDot:function(t){var e="digraph nn {\n    rankdir = BT\n",n=[this.layers.input].concat(this.layers.hidden,this.layers.output);for(var i in n)for(var o in n[i].connectedTo){var r=n[i].connectedTo[o],s=r.to,a=r.size,h=n.indexOf(n[i]),c=n.indexOf(s);if(t){if(r.gatedfrom.length){var u="fake"+h+"_"+c;e+="    "+u+' [label = "", shape = point, width = 0.01, height = 0.01]\n',e+="    "+h+" -> "+u+" [label = "+a+", arrowhead = none]\n",e+="    "+u+" -> "+c+"\n"}else e+="    "+h+" -> "+c+" [label = "+a+"]\n";for(var l in r.gatedfrom){var f=r.gatedfrom[l].layer,p=n.indexOf(f);e+="    "+p+" -> "+u+" [color = blue]\n"}}else{e+="    "+h+" -> "+c+" [label = "+a+"]\n";for(var l in r.gatedfrom){var f=r.gatedfrom[l].layer,p=n.indexOf(f);e+="    "+p+" -> "+c+" [color = blue]\n"}}}return e+="}\n",{code:e,link:"https://chart.googleapis.com/chart?chl="+escape(e.replace("/ /g","+"))+"&cht=gv"}},standalone:function(){this.optimized||this.optimize();var t=this.optimized.data,e="function (input) {\n";for(var n in t.inputs)e+="F["+t.inputs[n]+"] = input["+n+"];\n";for(var i in t.activate)for(var o in t.activate[i])e+=t.activate[i][o].join("")+"\n";e+="var output = [];\n";for(var n in t.outputs)e+="output["+n+"] = F["+t.outputs[n]+"];\n";e+="return output;\n}";var r=e.match(/F\[(\d+)\]/g),s=0,a={};for(var h in r){var c=r[h].match(/\d+/)[0];c in a||(a[c]=s++)}var u="F = {\n";for(var n in a)u+=a[n]+": "+this.optimized.memory[n]+",\n";return u=u.substring(0,u.length-2)+"\n};\n",u="var run = "+e.replace(/F\[(\d+)]/g,function(t){return"F["+a[t.match(/\d+/)[0]]+"]"}).replace("{\n","{\n"+u)+";\n",u+="return run",new Function(u)()},worker:function(t,n,i){var o={};i&&(o=i),o.rate=i.rate||.2,o.iterations=i.iterations||1e5,o.error=i.error||.005,o.cost=i.cost||null,o.crossValidate=i.crossValidate||null,costFunction="var cost = "+(i&&i.cost||this.cost||c.MSE)+";\n";var r=e.getWorkerSharedFunctions();r=r.replace(/var cost = options && options\.cost \|\| this\.cost \|\| Trainer\.cost\.MSE;/g,costFunction),r=r.replace("return results;",'postMessage({action: "done", message: results, memoryBuffer: F}, [F.buffer]);'),r=r.replace("console.log('iterations', iterations, 'error', error, 'rate', currentRate)","postMessage({action: 'log', message: {\niterations: iterations,\nerror: error,\nrate: currentRate\n}\n})"),r=r.replace("abort = this.schedule.do({ error: error, iterations: iterations, rate: currentRate })","postMessage({action: 'schedule', message: {\niterations: iterations,\nerror: error,\nrate: currentRate\n}\n})"),this.optimized||this.optimize();var s="var inputs = "+this.optimized.data.inputs.length+";\n";s+="var outputs = "+this.optimized.data.outputs.length+";\n",s+="var F =  new Float64Array(["+this.optimized.memory.toString()+"]);\n",s+="var activate = "+this.optimized.activate.toString()+";\n",s+="var propagate = "+this.optimized.propagate.toString()+";\n",s+="onmessage = function(e) {\nif (e.data.action == 'startTraining') {\ntrain("+JSON.stringify(n)+","+JSON.stringify(o)+");\n}\n}";var a=r+"\n"+s,h=new Blob([a]),u=window.URL.createObjectURL(h);return new Worker(u)},clone:function(){return e.fromJSON(this.toJSON())}},e.getWorkerSharedFunctions=function(){if(void 0!==e._SHARED_WORKER_FUNCTIONS)return e._SHARED_WORKER_FUNCTIONS;var t=r.prototype.train.toString();t=t.replace("function (set","function train(set")+"\n";var n=r.prototype._trainSet.toString().replace(/this.network./g,"");n=n.replace("function (set","function _trainSet(set")+"\n",n=n.replace("this.crossValidate","crossValidate"),n=n.replace("crossValidate = true","crossValidate = { }");var i=r.prototype.test.toString().replace(/this.network./g,"");return i=i.replace("function (set","function test(set")+"\n",e._SHARED_WORKER_FUNCTIONS=t+n+i},e.fromJSON=function(t){var n=[],r={input:new o,hidden:[],output:new o};for(var s in t.neurons){var a=t.neurons[s],h=i.fromJSON(a);n.push(h),"input"==a.layer?r.input.add(h):"output"==a.layer?r.output.add(h):(void 0===r.hidden[a.layer]&&(r.hidden[a.layer]=new o),r.hidden[a.layer].add(h))}for(var s in t.connections){var a=t.connections[s],c=n[a.from],u=n[a.to],l=a.weight,f=n[a.gater],p=c.project(u,l);f&&f.gate(p)}return new e(r)},e.crossOver=function(t,n,i){i=i||h.UNIFORM;var t=t.toJSON(),n=n.toJSON(),o=e.fromJSON(t).toJSON();switch(i){case h.UNIFORM:for(var r=0;r<o.neurons.length;r++)o.neurons[r].bias=Math.random()>=.5?t.neurons[r].bias:n.neurons[r].bias,o.neurons[r].squash=Math.random()>=.5?t.neurons[r].squash:n.neurons[r].squash;for(var r=0;r<o.connections.length;r++)o.connections[r].weight=Math.random()>=.5?t.connections[r].weight:n.connections[r].weight;break;case h.AVERAGE:for(var r=0;r<o.neurons.length;r++){var s=t.neurons[r].bias,a=n.neurons[r].bias;o.neurons[r].bias=(s+a)/2,o.neurons[r].squash=Math.random()>=.5?t.neurons[r].squash:n.neurons[r].squash}for(var r=0;r<o.connections.length;r++){var c=t.connections[r].weight,u=n.connections[r].weight;o.connections[r].weight=(c+u)/2}break;case h.SINGLE_POINT:for(var r=0;r<o.neurons.length;r++)r/o.neurons.length<h.SINGLE_POINT[0]?(o.neurons[r].bias=t.neurons[r].bias,o.neurons[r].squash=t.neurons[r].squash):(o.neurons[r].bias=n.neurons[r].bias,o.neurons[r].squash=n.neurons[r].squash);for(var r=0;r<o.connections.length;r++)r/o.connections.length<h.SINGLE_POINT[0]?o.connections[r].weight=t.connections[r].weight:o.connections[r].weight=n.connections[r].weight;break;case h.TWO_POINT:for(var r=0;r<o.neurons.length;r++)r/o.neurons.length<h.SINGLE_POINT[0]||r/o.neurons.length>h.SINGLE_POINT[1]?(o.neurons[r].bias=t.neurons[r].bias,o.neurons[r].squash=t.neurons[r].squash):(o.neurons[r].bias=n.neurons[r].bias,o.neurons[r].squash=n.neurons[r].squash);for(var r=0;r<o.connections.length;r++)r/o.connections.length<h.SINGLE_POINT[0]||r/o.connections.length>h.SINGLE_POINT[1]?o.connections[r].weight=t.connections[r].weight:o.connections[r].weight=n.connections[r].weight}return e.fromJSON(o)},e.merge=function(t,n){t=e.fromJSON(t.toJSON()),n=e.fromJSON(n.toJSON());var i=t.layers.input,o=[];for(var r in t.layers.hidden)o.push(t.layers.hidden[r]);var s=[];for(var r in n.layers.input.list)s.push(n.layers.input.list[r].ID);for(var a in n.layers.hidden[0].list)for(var h in n.layers.hidden[0].list[a].connections.inputs){var c=s.indexOf(n.layers.hidden[0].list[a].connections.inputs[h].from.ID);n.layers.hidden[0].list[a].connections.inputs[h].from=t.layers.output.list[c],t.layers.output.list[c].connections.projected[n.layers.hidden[0].list[a].connections.inputs[h].ID]=n.layers.hidden[0].list[a].connections.inputs[h]}o.push(t.layers.output);for(var r in n.layers.hidden)o.push(n.layers.hidden[r]);return new e({input:i,hidden:o,output:n.layers.output})}}).call(e,n(1)(t))},function(t,e,n){(function(t){function e(){this.ID=e.uid(),this.connections={inputs:{},projected:{},gated:{}},this.error={responsibility:0,projected:0,gated:0},this.trace={elegibility:{},extended:{},influences:{}},this.state=0,this.old=0,this.activation=0,this.selfconnection=new e.connection(this,this,0),this.squash=s.LOGISTIC,this.neighboors={},this.bias=.2*Math.random()-.1}t&&(t.exports=e);var i=n(2),o=n(0),r=o.Mutate,s=o.Squash,a=o.Crossover;o.Selection,o.Generation,o.Pooling,o.Cost,o.Connection;e.prototype={activate:function(t){if(void 0!==t)return this.activation=t,this.derivative=0,this.bias=0,this.activation;this.old=this.state,this.state=this.selfconnection.gain*this.selfconnection.weight*this.state+this.bias;for(var e in this.connections.inputs){var t=this.connections.inputs[e];this.state+=t.from.activation*t.weight*t.gain}this.activation=this.squash(this.state),this.derivative=this.squash(this.state,!0);var n=[];for(var i in this.trace.extended){var o=this.neighboors[i],r=o.selfconnection.gater==this?o.old:0;for(var s in this.trace.influences[o.ID])r+=this.trace.influences[o.ID][s].weight*this.trace.influences[o.ID][s].from.activation;n[o.ID]=r}for(var e in this.connections.inputs){var t=this.connections.inputs[e];this.trace.elegibility[t.ID]=this.selfconnection.gain*this.selfconnection.weight*this.trace.elegibility[t.ID]+t.gain*t.from.activation;for(var i in this.trace.extended){var a=this.trace.extended[i],o=this.neighboors[i],r=n[o.ID];a[t.ID]=o.selfconnection.gain*o.selfconnection.weight*a[t.ID]+this.derivative*this.trace.elegibility[t.ID]*r}}for(var h in this.connections.gated)this.connections.gated[h].gain=this.activation;return this.activation},propagate:function(t,e){var n=0;if(void 0!==e)this.error.responsibility=this.error.projected=e-this.activation;else{for(var i in this.connections.projected){var o=this.connections.projected[i],r=o.to;n+=r.error.responsibility*o.gain*o.weight}this.error.projected=this.derivative*n,n=0;for(var i in this.trace.extended){var r=this.neighboors[i],s=r.selfconnection.gater==this?r.old:0;for(var a in this.trace.influences[i])s+=this.trace.influences[i][a].weight*this.trace.influences[r.ID][a].from.activation;n+=r.error.responsibility*s}this.error.gated=this.derivative*n,this.error.responsibility=this.error.projected+this.error.gated}t=t||.1;for(var i in this.connections.inputs){var a=this.connections.inputs[i],h=this.error.projected*this.trace.elegibility[a.ID];for(var i in this.trace.extended){var r=this.neighboors[i];h+=r.error.responsibility*this.trace.extended[r.ID][a.ID]}a.weight+=t*h}this.bias+=t*this.error.responsibility},project:function(t,n){if(t instanceof e){if(t==this)return this.selfconnection.weight=1,this.selfconnection;var o=this.connected(t);if(o&&"projected"==o.type)return void 0!==n&&(o.connection.weight=n),o.connection;var r=new e.connection(this,t,n);this.connections.projected[r.ID]=r,this.neighboors[t.ID]=t,t.connections.inputs[r.ID]=r,t.trace.elegibility[r.ID]=0;for(var s in t.trace.extended){t.trace.extended[s][r.ID]=0}return r}if(t instanceof i){var a=[];for(var h in t.list){var c=this.project(t.list[h]);a.push(c)}return a}if(t instanceof Network){var r=this.project(t.layers.input);return r}},gate:function(t){this.connections.gated[t.ID]=t;var e=t.to;if(!(e.ID in this.trace.extended)){this.neighboors[e.ID]=e;var n=this.trace.extended[e.ID]={};for(var i in this.connections.inputs){n[this.connections.inputs[i].ID]=0}}e.ID in this.trace.influences?this.trace.influences[e.ID].push(t):this.trace.influences[e.ID]=[t],t.gater=this},selfconnected:function(){return 0!==this.selfconnection.weight},connected:function(t){var e={type:null,connection:!1};if(this==t)return!!this.selfconnected()&&(e.type="selfconnection",e.connection=this.selfconnection,e);for(var n in this.connections)for(var i in this.connections[n]){var i=this.connections[n][i];if(i.to==t)return e.type=n,e.connection=i,e;if(i.from==t)return e.type=n,e.connection=i,e}return!1},clear:function(){for(var t in this.trace.elegibility)this.trace.elegibility[t]=0;for(var t in this.trace.extended)for(var e in this.trace.extended[t])this.trace.extended[t][e]=0;this.error.responsibility=this.error.projected=this.error.gated=0},disconnect:function(){this.connections={inputs:{},projected:{},gated:{}}},reset:function(){this.clear();for(var t in this.connections)for(var e in this.connections[t])this.connections[t][e].weight=.2*Math.random()-.1;this.bias=.2*Math.random()-.1,this.old=this.state=this.activation=0},mutate:function(t){switch(t=t||r.MODIFY_RANDOM_WEIGHT){case r.SWAP_WEIGHT:for(var e=Object.keys(this.connections),n=2;n>=0;n--)0==Object.keys(this.connections[e[n]]).length&&e.splice(n,1);for(var i=e[Math.floor(Math.random()*e.length)],o=Object.keys(this.connections[i]),s=o[Math.floor(Math.random()*o.length)],a=s;a==s;){var h=e[Math.floor(Math.random()*e.length)],c=Object.keys(this.connections[h]);a=c[Math.floor(Math.random()*c.length)]}var u=this.connections[i][s].weight;this.connections[i][s].weight=this.connections[h][a].weight,this.connections[h][a].weight=u;break;case r.MODIFY_RANDOM_BIAS:var l=Math.random()*(r.MODIFY_RANDOM_BIAS.config.max-r.MODIFY_RANDOM_BIAS.config.min)+r.MODIFY_RANDOM_BIAS.config.min;this.bias+=l;break;case r.MODIFY_RANDOM_WEIGHT:for(var f=Object.keys(this.connections),n=2;n>=0;n--)0==Object.keys(this.connections[f[n]]).length&&f.splice(n,1);f=f[Math.floor(Math.random()*f.length)];var p=Object.keys(this.connections[f]),d=p[Math.floor(Math.random()*p.length)],l=Math.random()*(r.MODIFY_RANDOM_WEIGHT.config.max-r.MODIFY_RANDOM_WEIGHT.config.min)+r.MODIFY_RANDOM_WEIGHT.config.min;this.connections[f][d].weight+=l;break;case r.MODIFY_SQUASH:for(var v=Math.floor(Math.random()*r.MODIFY_SQUASH.config.allowed.length);r.MODIFY_SQUASH.config.allowed[v]==this.squash;)v=Math.floor(Math.random()*r.MODIFY_SQUASH.config.allowed.length);this.squash=r.MODIFY_SQUASH.config.allowed[v]}},optimize:function(t,e){t=t||{};var n=[],i=[],o=[],r=t.memory||0,a=t.neurons||1,h=t.inputs||[],c=t.targets||[],u=t.outputs||[],l=t.variables||{},f=t.activation_sentences||[],p=t.trace_sentences||[],d=t.propagation_sentences||[],v=t.layers||{__count:0,__neuron:0},g=function(t){e in v&&t[v.__count]||(v.__count=t.push([])-1,v[e]=v.__count)};g(f),g(p),g(d);var M=v.__count,m=function(){var t=Array.prototype.slice.call(arguments);if(1==t.length){if("target"==t[0]){var e="target_"+c.length;c.push(r)}else var e=t[0];return e in l?l[e]:l[e]={value:0,id:r++}}var n=t.length>2;if(n)var i=t.pop();var o=t.shift(),s=t.pop();if(!n)var i=o[s];var e=s+"_";for(var a in t)e+=t[a]+"_";return e+=o.ID,e in l?l[e]:l[e]={value:i,id:r++}},O=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),n="";for(var i in t)n+="string"==typeof t[i]?t[i]:"F["+t[i].id+"]";e.push(n+";")},I=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},y=I(this.connections.projected),w=I(this.connections.gated),S="input"==e||I(this.connections.inputs),b="output"==e||y&&w,_=m("rate"),N=m(this,"activation");if(S)h.push(N.id);else{f[M].push(n),p[M].push(i),d[M].push(o);var T=m(this,"old"),D=m(this,"state"),A=m(this,"bias");if(this.selfconnection.gater)var E=m(this.selfconnection,"gain");if(this.selfconnected())var z=m(this.selfconnection,"weight");O(T," = ",D,n),this.selfconnected()?this.selfconnection.gater?O(D," = ",E," * ",z," * ",D," + ",A,n):O(D," = ",z," * ",D," + ",A,n):O(D," = ",A,n);for(var j in this.connections.inputs){var F=this.connections.inputs[j],k=m(F.from,"activation"),R=m(F,"weight");if(F.gater)var P=m(F,"gain");this.connections.inputs[j].gater?O(D," += ",k," * ",R," * ",P,n):O(D," += ",k," * ",R,n)}var L=m(this,"derivative");switch(this.squash){case s.LOGISTIC:O(N," = (1 / (1 + Math.exp(-",D,")))",n),O(L," = ",N," * (1 - ",N,")",n);break;case s.TANH:var x=m("aux"),q=m("aux_2");O(x," = Math.exp(",D,")",n),O(q," = 1 / ",x,n),O(N," = (",x," - ",q,") / (",x," + ",q,")",n),O(L," = 1 - (",N," * ",N,")",n);break;case s.IDENTITY:O(N," = ",D,n),O(L," = 1",n);break;case s.HLIM:O(N," = +(",D," > 0)",n),O(L," = 1",n);break;case s.RELU:O(N," = ",D," > 0 ? ",D," : 0",n),O(L," = ",D," > 0 ? 1 : 0",n);break;case s.SOFTSIGN:O(N," = ",D," / (1 + Math.abs(",D,"))",n),O(L," = ",D," / Math.pow(","(1 + Math.abs(",D,"))",", 2)",n);break;case s.SINUSOID:O(N," = Math.sin(",D,")",n),O(L," = Math.cos(",D,")",n);break;case s.GAUSSIAN:O(N," = ","Math.exp(-Math.pow(",D,", 2))",n),O(L," = ","-2 * ",D," * Math.exp(-Math.pow(",D,", 2))",n)}for(var G in this.trace.extended){var U=this.neighboors[G],Y=m("influences["+U.ID+"]"),H=m(U,"old"),C=!1;U.selfconnection.gater==this&&(O(Y," = ",H,i),C=!0);for(var W in this.trace.influences[U.ID]){var B=m(this.trace.influences[U.ID][W],"weight"),V=m(this.trace.influences[U.ID][W].from,"activation");C?O(Y," += ",B," * ",V,i):(O(Y," = ",B," * ",V,i),C=!0)}}for(var j in this.connections.inputs){var F=this.connections.inputs[j];if(F.gater)var P=m(F,"gain");var k=m(F.from,"activation"),J=m(this,"trace","elegibility",F.ID,this.trace.elegibility[F.ID]);this.selfconnected()?this.selfconnection.gater?F.gater?O(J," = ",E," * ",z," * ",J," + ",P," * ",k,i):O(J," = ",E," * ",z," * ",J," + ",k,i):F.gater?O(J," = ",z," * ",J," + ",P," * ",k,i):O(J," = ",z," * ",J," + ",k,i):F.gater?O(J," = ",P," * ",k,i):O(J," = ",k,i);for(var G in this.trace.extended){var U=this.neighboors[G],Y=m("influences["+U.ID+"]"),J=m(this,"trace","elegibility",F.ID,this.trace.elegibility[F.ID]),Q=m(this,"trace","extended",U.ID,F.ID,this.trace.extended[U.ID][F.ID]);if(U.selfconnected())var X=m(U.selfconnection,"weight");if(U.selfconnection.gater)var K=m(U.selfconnection,"gain");U.selfconnected()?U.selfconnection.gater?O(Q," = ",K," * ",X," * ",Q," + ",L," * ",J," * ",Y,i):O(Q," = ",X," * ",Q," + ",L," * ",J," * ",Y,i):O(Q," = ",L," * ",J," * ",Y,i)}}for(var Z in this.connections.gated){O(m(this.connections.gated[Z],"gain")," = ",N,n)}}if(!S){var $=m(this,"error","responsibility",this.error.responsibility);if(b){O($," = ",m("target")," - ",N,o);for(var G in this.connections.inputs){var F=this.connections.inputs[G],J=m(this,"trace","elegibility",F.ID,this.trace.elegibility[F.ID]),R=m(F,"weight");O(R," += ",_," * (",$," * ",J,")",o)}u.push(N.id)}else if(y||w){if(w){O($," = 0",o);for(var G in this.connections.projected){var Z=this.connections.projected[G],U=Z.to,tt=m(Z,"weight"),et=m(U,"error","responsibility",U.error.responsibility);if(Z.gater){var nt=m(Z,"gain");O($," += ",et," * ",nt," * ",tt,o)}else O($," += ",et," * ",tt,o)}O($," *= ",L,o);for(var G in this.connections.inputs){var F=this.connections.inputs[G],J=m(this,"trace","elegibility",F.ID,this.trace.elegibility[F.ID]),R=m(F,"weight");O(R," += ",_," * (",$," * ",J,")",o)}}else if(y){O($," = 0",o);for(var G in this.trace.extended){var U=this.neighboors[G],Y=m("aux"),H=m(U,"old");U.selfconnection.gater==this?O(Y," = ",H,o):O(Y," = 0",o);for(var F in this.trace.influences[U.ID]){var Z=this.trace.influences[U.ID][F],tt=m(Z,"weight"),it=m(Z.from,"activation");O(Y," += ",tt," * ",it,o)}var et=m(U,"error","responsibility",U.error.responsibility);O($," += ",et," * ",Y,o)}O($," *= ",L,o);for(var G in this.connections.inputs){var F=this.connections.inputs[G],ot=m("aux");O(ot," = 0",o);for(var G in this.trace.extended){var U=this.neighboors[G],et=m(U,"error","responsibility",U.error.responsibility),Q=m(this,"trace","extended",U.ID,F.ID,this.trace.extended[U.ID][F.ID]);O(ot," += ",et," * ",Q,o)}var R=m(F,"weight");O(R," += ",_," * ",ot,o)}}}else{var rt=m("aux");for(var G in this.connections.projected){var Z=this.connections.projected[G],U=Z.to,tt=m(Z,"weight"),et=m(U,"error","responsibility",U.error.responsibility);if(Z.gater){var nt=m(Z,"gain");O(rt," += ",et," * ",nt," * ",tt,o)}else O(rt," += ",et," * ",tt,o)}var st=m(this,"error","projected",this.error.projected);O(st," = ",L," * ",rt,o),O(rt," = 0",o);for(var G in this.trace.extended){var U=this.neighboors[G],Y=m("aux_2"),H=m(U,"old");U.selfconnection.gater==this?O(Y," = ",H,o):O(Y," = 0",o);for(var F in this.trace.influences[U.ID]){var Z=this.trace.influences[U.ID][F],tt=m(Z,"weight"),it=m(Z.from,"activation");O(Y," += ",tt," * ",it,o)}var et=m(U,"error","responsibility",U.error.responsibility);O(rt," += ",et," * ",Y,o)}var at=m(this,"error","gated",this.error.gated);O(at," = ",L," * ",rt,o),O($," = ",st," + ",at,o);for(var G in this.connections.inputs){var F=this.connections.inputs[G],ot=m("aux"),J=m(this,"trace","elegibility",F.ID,this.trace.elegibility[F.ID]);O(ot," = ",st," * ",J,o);for(var G in this.trace.extended){var U=this.neighboors[G],et=m(U,"error","responsibility",U.error.responsibility),Q=m(this,"trace","extended",U.ID,F.ID,this.trace.extended[U.ID][F.ID]);O(ot," += ",et," * ",Q,o)}var R=m(F,"weight");O(R," += ",_," * ",ot,o)}}O(A," += ",_," * ",$,o)}return{memory:r,neurons:a+1,inputs:h,outputs:u,targets:c,variables:l,activation_sentences:f,trace_sentences:p,propagation_sentences:d,layers:v}},toJSON:function(){var t={trace:{elegibility:{},extended:{}},state:this.state,old:this.old,activation:this.activation,bias:this.bias};return t.squash=this.squash==s.LOGISTIC?"LOGISTIC":this.squash==s.TANH?"TANH":this.squash==s.IDENTITY?"IDENTITY":this.squash==s.HLIM?"HLIM":this.squash==s.RELU?"RELU":this.squash==s.SOFTSIGN?"SOFTSIGN":this.squash==s.SINUSOID?"SINUSOID":this.squash==s.GAUSSIAN?"GAUSSIAN":null,t}},e.fromJSON=function(t){var n=new e;return n.trace.elegibility={},n.trace.extended={},n.state=t.state,n.old=t.old,n.activation=t.activation,n.bias=t.bias,n.squash=t.squash in s?s[t.squash]:s.LOGISTIC,n},e.connection=function(t,n,i){if(!t||!n)throw new Error("Connection Error: Invalid neurons");this.ID=e.connection.uid(),this.from=t,this.to=n,this.weight=void 0===i?.2*Math.random()-.1:i,this.gain=1,this.gater=null},e.crossOver=function(t,n,i){i=i||a.UNIFORM;var o=new e;switch(i){case a.UNIFORM:o.bias=Math.random()>=.5?t.bias:n.bias,o.squash=Math.random()>=.5?t.squash:n.squash;break;case a.AVERAGE:o.bias=(t.bias+n.bias)/2,o.squash=Math.random()>=.5?t.squash:n.squash}return o},function(){var t=0,n=0;e.uid=function(){return t++},e.connection.uid=function(){return n++},e.quantity=function(){return{neurons:t,connections:n}}}()}).call(e,n(1)(t))},function(t,e,n){(function(t){function e(t,e){e=e||{},this.network=t,this.rate=e.rate||.2,this.iterations=e.iterations||1e5,this.error=e.error||.005,this.cost=e.cost||null,this.crossValidate=e.crossValidate||null}t&&(t.exports=e);var i=n(0),o=(i.Mutate,i.Squash,i.Crossover,i.Selection,i.Generation,i.Pooling,i.Cost);i.Connection;e.prototype={train:function(t,e){function n(t){for(var e,n,i=t.length;i;e=Math.floor(Math.random()*i),n=t[--i],t[i]=t[e],t[e]=n);return t}var i,r,s,a=1,h=p=0,c=!1,u=e&&e.cost||this.cost||o.MSE,l=!1,f=Date.now();if(e&&(e.shuffle,e.iterations&&(this.iterations=e.iterations),e.error&&(this.error=e.error),e.rate&&(this.rate=e.rate),e.cost&&(this.cost=e.cost),e.schedule&&(this.schedule=e.schedule),e.customLog&&(console.log("Deprecated: use schedule instead of customLog"),this.schedule=e.customLog),(this.crossValidate||e.crossValidate)&&(this.crossValidate||(this.crossValidate={}),l=!0,e.crossValidate.testSize&&(this.crossValidate.testSize=e.crossValidate.testSize),e.crossValidate.testError&&(this.crossValidate.testError=e.crossValidate.testError))),i=this.rate,Array.isArray(this.rate))var p=Math.floor(this.iterations/this.rate.length);if(l){var d=Math.ceil((1-this.crossValidate.testSize)*t.length);s=t.slice(0,d),r=t.slice(d)}for(var v=0;!c&&h<this.iterations&&a>this.error&&!(l&&a<=this.crossValidate.testError);){var g=t.length;if(a=0,h++,p>0){var M=Math.floor(h/p);i=this.rate[M]||i}"function"==typeof this.rate&&(i=this.rate(h,v)),l?(this._trainSet(s,i,u),a+=this.test(r).error,g=1):(a+=this._trainSet(t,i,u),g=t.length),a/=g,v=a,e&&(this.schedule&&this.schedule.every&&h%this.schedule.every==0?c=this.schedule.do({error:a,iterations:h,rate:i}):e.log&&h%e.log==0&&console.log("iterations",h,"error",a,"rate",i),e.shuffle&&n(t))}return{error:a,iterations:h,time:Date.now()-f}},trainAsync:function(t,e){var n=this.workerTrain.bind(this);return new Promise(function(i,o){try{n(t,i,e,!0)}catch(t){o(t)}})},_trainSet:function(t,e,n){var i=0;for(var o in t){var r=t[o].input,s=t[o].output,a=this.network.activate(r);this.network.propagate(e,s),i+=n(s,a)}return i},test:function(t,e){var n,i,r,s=0,a=e&&e.cost||this.cost||o.MSE,h=Date.now();for(var c in t)n=t[c].input,r=t[c].output,i=this.network.activate(n),s+=a(r,i);return s/=t.length,{error:s,time:Date.now()-h}},workerTrain:function(t,e,n,i){i||console.warn("Deprecated: do not use `workerTrain`, use `trainAsync` instead.");var o=this;this.network.optimized||this.network.optimize();var r=this.network.worker(this.network.optimized.memory,t,n);r.onmessage=function(t){switch(t.data.action){case"done":var i=t.data.message.iterations,s=t.data.message.error,a=t.data.message.time;o.network.optimized.ownership(t.data.memoryBuffer),e({error:s,iterations:i,time:a}),r.terminate();break;case"log":console.log(t.data.message);case"schedule":if(n&&n.schedule&&"function"==typeof n.schedule.do){(0,n.schedule.do)(t.data.message)}}},r.postMessage({action:"startTraining"})},XOR:function(t){if(2!=this.network.inputs()||1!=this.network.outputs())throw new Error("Incompatible network (2 inputs, 1 output)");var e={iterations:1e5,log:!1,shuffle:!0,cost:o.MSE};if(t)for(var n in t)e[n]=t[n];return this.train([{input:[0,0],output:[0]},{input:[1,0],output:[1]},{input:[0,1],output:[1]},{input:[1,1],output:[0]}],e)},DSR:function(t){t=t||{};var e,n,i,r,s,a=t.targets||[2,4,7,8],h=t.distractors||[3,5,6,9],c=t.prompts||[0,1],u=t.length||24,l=t.success||.95,f=t.iterations||1e5,p=t.rate||.1,d=t.log||0,v=t.schedule||{},g=t.cost||this.cost||o.CROSS_ENTROPY;e=n=i=r=s=0;for(var M=1,m=a.length+h.length+c.length,O=function(t,e){var n=Math.random()*t|0,i=!1;for(var o in e)n==e[o]&&(i=!0);return i?O(t,e):n},I=function(t,e){for(var n in t)if(Math.round(t[n])!=e[n])return!1;return!0},y=Date.now();e<f&&(s<l||e%1e3!=0);){var w=[],S=u-c.length;for(i=0;i<S;i++){var b=Math.random()*h.length|0;w.push(h[b])}var _=[],N=[];for(i=0;i<c.length;i++)_.push(Math.random()*a.length|0),N.push(O(S,N));for(N=N.sort(),i=0;i<c.length;i++)w[N[i]]=a[_[i]],w.push(c[i]);var T,D=T=0;for(M=0,i=0;i<u;i++){var A=[];for(r=0;r<m;r++)A[r]=0;A[w[i]]=1;var E=[];for(r=0;r<a.length;r++)E[r]=0;if(i>=S){E[_[i-S]]=1}var z=this.network.activate(A);I(z,E)?i<S?T++:D++:this.network.propagate(p,E),M+=g(E,z),T+D==u&&n++}e%1e3==0&&(n=0),e++;var j=e%1e3;j=0==j?1e3:j,s=n/j,M/=u,d&&e%d==0&&console.log("iterations:",e," success:",s," correct:",n," time:",Date.now()-y," error:",M),v.do&&v.every&&e%v.every==0&&v.do({iterations:e,success:s,error:M,time:Date.now()-y,correct:n})}return{iterations:e,success:s,error:M,time:Date.now()-y}},ERG:function(t){t=t||{};var e=t.iterations||15e4,n=t.error||.05,i=t.rate||.1,r=t.log||500,s=t.cost||this.cost||o.CROSS_ENTROPY,a=function(){this.paths=[]};a.prototype={connect:function(t,e){return this.paths.push({node:t,value:e}),this},any:function(){if(0==this.paths.length)return!1;var t=Math.random()*this.paths.length|0;return this.paths[t]},test:function(t){for(var e in this.paths)if(this.paths[e].value==t)return this.paths[e];return!1}};for(var h=function(){var t=new a,e=(new a).connect(t,"E"),n=(new a).connect(e,"S"),i=(new a).connect(e,"V").connect(n,"P"),o=(new a).connect(n,"X");o.connect(o,"S");var r=(new a).connect(i,"V");r.connect(r,"T"),n.connect(r,"X");var s=(new a).connect(o,"T").connect(r,"P");return{input:(new a).connect(s,"B"),output:t}},c=function(){var t=h(),e=h(),n=new a,i=(new a).connect(n,"E");t.output.connect(i,"T"),e.output.connect(i,"P");var o=(new a).connect(t.input,"P").connect(e.input,"T");return{input:(new a).connect(o,"B"),output:n}},u=function(){for(var t=c().input,e=t.any(),n="";e;)n+=e.value,e=e.node.any();return n},l=function(t){for(var e=c().input,n=0,i=t.charAt(n);n<t.length;){var o=e.test(i);if(!o)return!1;e=o.node,i=t.charAt(++n)}return!0},f=function(t,e){var n=0,i=-1,o=0,r=-1;for(var s in t)t[s]>n&&(n=t[s],i=s),e[s]>o&&(o=e[s],r=s);return i!=r},p=0,d=1,v={B:0,P:1,T:2,X:3,S:4,E:5},g=Date.now();p<e&&d>n;){var M=0;d=0;for(var m=u(),O=m.charAt(M),I=m.charAt(M+1);M<m.length-1;){for(var y=[],w=[],S=0;S<6;S++)y[S]=0,w[S]=0;y[v[O]]=1,w[v[I]]=1;var b=this.network.activate(y);f(b,w)&&this.network.propagate(i,w),O=m.charAt(++M),I=m.charAt(M+1),d+=s(w,b)}d/=m.length,p++,p%r==0&&console.log("iterations:",p," time:",Date.now()-g," error:",d)}return{iterations:p,error:d,time:Date.now()-g,test:l,generate:u}},timingTask:function(t){function e(t,e){for(var n=t+e,i=0,o=[],r=0;r<n;r++)o.push({input:[0,0],output:[0]});for(;i<n-20;){var s=Math.round(20*Math.random());o[i].input[0]=1;for(var a=i;a<=i+s;a++)o[a].input[1]=s/20,o[a].output[0]=.5;i+=s,s=Math.round(20*Math.random());for(var h=i+1;h<=i+s&&h<n;h++)o[h].input[1]=o[i].input[1];i+=s}for(var c=[],u=[],l=0;l<n;l++)(l<t?c:u).push(o[l]);return{train:c,test:u}}if(2!=this.network.inputs()||1!=this.network.outputs())throw new Error("Invalid Network: must have 2 inputs and one output");void 0===t&&(t={});var n=t.iterations||200,i=t.error||.005,r=t.rate||[.03,.02],s=t.log!==!1&&(t.log||10),a=t.cost||this.cost||o.MSE,h=t.trainSamples||7e3,c=t.trainSamples||1e3,u=e(h,c);return{train:this.train(u.train,{rate:r,log:s,iterations:n,error:i,cost:a}),test:this.test(u.test)}}}}).call(e,n(1)(t))},function(t,e,n){(function(t){var e=n(2),i=n(3),o=n(5),r=n(0),s=(r.Mutate,r.Squash,r.Crossover,r.Selection,r.Generation,r.Pooling,r.Cost,r.Connection),a={Perceptron:function(){var t=Array.prototype.slice.call(arguments);if(t.length<3)throw new Error("not enough layers (minimum 3) !!");var n=t.shift(),i=t.pop(),r=t,s=new e(n),a=[],h=new e(i),c=s;for(var u in r){var l=r[u],f=new e(l);a.push(f),c.project(f),c=f}c.project(h),this.set({input:s,hidden:a,output:h}),this.trainer=new o(this)},LSTM:function(){var t=Array.prototype.slice.call(arguments);if(t.length<3)throw new Error("not enough layers (minimum 3) !!");var n=t.pop(),i={peepholes:s.ALL_TO_ALL,hiddenToHidden:!1,outputToHidden:!1,outputToGates:!1,inputToOutput:!0};if("number"!=typeof n){var r=t.pop();n.hasOwnProperty("peepholes")&&(i.peepholes=n.peepholes),n.hasOwnProperty("hiddenToHidden")&&(i.hiddenToHidden=n.hiddenToHidden),n.hasOwnProperty("outputToHidden")&&(i.outputToHidden=n.outputToHidden),n.hasOwnProperty("outputToGates")&&(i.outputToGates=n.outputToGates),n.hasOwnProperty("inputToOutput")&&(i.inputToOutput=n.inputToOutput)}else var r=n;var a=t.shift(),h=t,c=new e(a),u=[],l=new e(r),f=null;for(var p in h){var d=h[p],v=new e(d).set({bias:1}),g=new e(d).set({bias:1}),M=new e(d),m=new e(d).set({bias:1});u.push(v),u.push(g),u.push(M),u.push(m);var O=c.project(M);if(c.project(v),c.project(g),c.project(m),null!=f){var I=f.project(M);f.project(v),f.project(g),f.project(m)}var y=M.project(l),w=M.project(M);i.hiddenToHidden&&M.project(M,s.ALL_TO_ELSE),i.outputToHidden&&l.project(M),i.outputToGates&&(l.project(v),l.project(m),l.project(g)),M.project(v,i.peepholes),M.project(g,i.peepholes),M.project(m,i.peepholes),v.gate(O,e.gateType.INPUT),g.gate(w,e.gateType.ONE_TO_ONE),m.gate(y,e.gateType.OUTPUT),null!=f&&v.gate(I,e.gateType.INPUT),f=M}i.inputToOutput&&c.project(l),this.set({input:c,hidden:u,output:l}),this.trainer=new o(this)},Liquid:function(t,n,i,r,s){for(var a=new e(t),h=new e(n),c=new e(i),u=h.neurons(),l=[],f=0;f<r;f++){var p=Math.random()*u.length|0,d=Math.random()*u.length|0,v=u[p].project(u[d]);l.push(v)}for(var g=0;g<s;g++){var M=Math.random()*u.length|0,v=Math.random()*l.length|0;u[M].gate(l[v])}a.project(h),h.project(c),this.set({input:a,hidden:[h],output:c}),this.trainer=new o(this)},Hopfield:function(t){var n=new e(t),i=new e(t);n.project(i,s.ALL_TO_ALL),this.set({input:n,hidden:[],output:i});var r=new o(this),h=a.Hopfield.prototype;h.learn=h.learn||function(t){var e=[];for(var n in t)e.push({input:t[n],output:t[n]});return r.train(e,{iterations:5e5,error:5e-5,rate:1})},h.feed=h.feed||function(t){var e=this.activate(t),t=[];for(var n in e)t[n]=e[n]>.5?1:0;return t}}};for(var h in a)a[h].prototype=new i,a[h].prototype.constructor=a[h];t&&(t.exports=a)}).call(e,n(1)(t))},function(t,e,n){(function(t){function e(t){this.size=[t.input,t.hidden.length,t.output],this.nodes=[];for(var e=0;e<t.input;e++){var n=new i;n.input=!0,this.nodes.push(n)}for(var e in t.hidden)t.hidden[e].input=!1,this.nodes.push(t.hidden[e]);for(var e=0;e<t.output;e++){var n=new i;n.input=!1,this.nodes.push(n)}this.connect(t.memory,t.ratio)}t&&(t.exports=e);var i=n(4),o=(n(2),n(0));o.Mutate,o.Squash,o.Crossover,o.Selection,o.Generation,o.Pooling,o.Cost,o.Connection;e.prototype={connect:function(t,e){t=t||0,e=e||3;for(var n=0;n<e;n++)for(var i=0;i<this.size[0]+this.size[1];i++){var o=i,r=Math.max(i+1,this.size[0]),s=Math.floor(Math.random()*(this.size[0]+this.size[1]+this.size[2]-r)+r);this.nodes[o].project(this.nodes[s]),this.nodes[s].input=!0}for(var i=this.size[0];i<this.size[0]+this.size[1]+this.size[2];i++){var s=i;if(0==this.nodes[s].input){var o=Math.floor(Math.random()*i);this.nodes[o].project(this.nodes[s]),this.nodes[s].input=!0}}for(;t>0;){var o=Math.floor(Math.random()*(this.size[1]+this.size[2])+this.size[0]),s=Math.floor(Math.random()*o);this.nodes[o].project(this.nodes[s]),t--}},activate:function(t){if(t.length!=this.size[0])throw new Error("Incorrect input size!");for(var e=[],n=0;n<this.size[0]+this.size[1]+this.size[2];n++)n<this.size[0]?this.nodes[n].activate(t[n]):n>=this.size[0]+this.size[1]?e.push(this.nodes[n].activate()):this.nodes[n].activate();return e},propagate:function(t,e){if(e.length!=this.size[2])throw new Error("Incorrect target size!");for(var n=this.size[0]+this.size[1]+this.size[2]-1;n>=0;n--)n<this.size[0]||(n>=this.size[0]+this.size[1]?this.nodes[n].propagate(t,e[n-(this.size[0]+this.size[1]+this.size[2]-1)]):this.nodes[n].propagate(t))},clear:function(){for(var t in this.nodes)this.nodes[t].reset()},reset:function(){for(var t in this.nodes)this.nodes[t].reset()},disconnect:function(){for(var t in this.nodes)this.nodes[t].disconnect()}}}).call(e,n(1)(t))},function(t,e,n){(function(t){function e(t){t=t||{},this.size=t.size||50,this.mutationRate=t.mutationRate||.05,this.generationMethod=t.generationMethod||[u.POINTS],this.mutationMethod=t.mutationMethod||[a.MODIFY_RANDOM_WEIGHT,a.MODIFY_RANDOM_BIAS],this.crossOverMethod=t.crossOverMethod||[h.UNIFORM],this.selectionMethod=t.selectionMethod||[c.FITNESS_PROPORTIONATE],this.fitnessFunction=t.fitnessFunction,this.networkSize=t.networkSize||[1,4,1],this.elitism=t.elitism||Math.round(this.size/20),this.population=[],this.createPool(),this.newPopulation=[],this.parentSelection=[],this.scores=[],this.generation=0}t&&(t.exports=e);var i=n(2),o=n(3),r=n(5),s=n(0),a=s.Mutate,h=(s.Squash,s.Crossover),c=s.Selection,u=s.Generation;s.Pooling,s.Cost,s.Connection;e.prototype={createPool:function(){for(var t=0;t<this.size;t++){var e=this.createNetwork();this.population.push(e)}},createNetwork:function(){for(var t=new i(this.networkSize[0]),e=new i(this.networkSize[this.networkSize.length-1]),n=[],s=0;s<this.networkSize.length-2;s++)n.push(new i(this.networkSize[s+1])),s>0&&n[s-1].project(n[s]);t.project(n[0]),n[n.length-1].project(e);var a=new o({input:t,hidden:n,output:e});switch(this.generationMethod[Math.floor(Math.random()*this.generationMethod.length)]){case u.DEFAULT:break;case u.POINTS:for(var h=new r(a),c=[],l=0;l<u.POINTS.config.points;l++){for(var f=[],p=[],l=0;l<t.size;l++)f.push(Math.random());for(var l=0;l<e.size;l++)p.push(Math.random());c.push({input:f,output:p})}h.train(c,{rate:u.POINTS.config.rate,error:u.POINTS.config.error,iterations:u.POINTS.config.iterations,shuffle:u.POINTS.config.shuffle,cost:u.POINTS.config.cost})}return a},evaluate:function(){for(var t in this.population){var e=this.fitnessFunction(this.population[t]);this.scores.push(e)}},select:function(){for(var t=this.getSortedIndex(),e=0;e<this.elitism;e++)this.newPopulation.push(this.population[t[e]]);for(var e=0;e<2*(this.size-this.elitism);e++){var n=this.getParent(t);this.parentSelection.push(n)}},crossOver:function(){for(var t=0;t<this.parentSelection.length;t+=2){var e=this.crossOverMethod[Math.floor(Math.random()*this.crossOverMethod.length)],n=o.crossOver(this.parentSelection[t],this.parentSelection[t+1],e);this.newPopulation.push(n)}},mutate:function(){for(var t=0;t<this.newPopulation.length;t++)if(Math.random()<this.mutationRate){var e=this.mutationMethod[Math.floor(Math.random()*this.mutationMethod.length)];this.newPopulation[t].mutate(e)}},replace:function(){this.population=this.newPopulation,this.newPopulation=[],this.parentSelection=[],this.scores=[],this.generation++},getParent:function(t){switch(this.selectionMethod[Math.floor(Math.random()*this.selectionMethod.length)]){case c.FITNESS_PROPORTIONATE:var e=Math.floor(c.FITNESS_PROPORTIONATE.config(Math.random())*this.size);return this.population[t[e]]}},getSortedIndex:function(){for(var t=this.scores.slice(),e=[],n=0;n<t.length;n++){var i=t.indexOf(Math.max.apply(Math,t));t[i]=-(1/0),e.push(i)}return e},getAverage:function(){return this.scores.reduce(function(t,e){return t+e})/this.scores.length},getFittestGenome:function(){var t=this.getSortedIndex();return this.population[t[0]]},exportPool:function(){var t=[];for(var e in this.population)t.push(this.population[e].toJSON());return t},importPool:function(t){this.size=t.length,this.population=[];for(var e in t){var n=o.fromJSON(t[e]);this.population.push(n)}}}}).call(e,n(1)(t))},function(t,e,n){var i,o,r={Neuron:n(4),Evolution:n(8),Trainer:n(5),Methods:n(0),Layer:n(2),Network:n(3),Architect:n(6),Brain:n(7)};i=[],void 0!==(o=function(){return r}.apply(e,i))&&(t.exports=o),void 0!==t&&t.exports&&(t.exports=r),"object"==typeof window&&(!function(){var t=window.gynaptic;r.ninja=function(){return window.gynaptic=t,r}}(),window.gynaptic=r)}]);