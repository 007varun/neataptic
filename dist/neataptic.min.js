/*!
 * The MIT License (MIT)
 * 
 * Copyright 2017 Thomas Wagenaar <wagenaartje@protonmail.com>
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE
 * 
 */
!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.neataptic=n():t.neataptic=n()}(this,function(){return function(t){function n(e){if(o[e])return o[e].exports;var i=o[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var o={};return n.m=t,n.c=o,n.i=function(t){return t},n.d=function(t,o,e){n.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:e})},n.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(o,"a",o),o},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=16)}([function(t,n){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,n,o){var e,i,s={Activation:o(8),Mutation:o(14),Selection:o(15),Crossover:o(12),Cost:o(11),Gating:o(13),Connection:o(10)};e=[],void 0!==(i=function(){return s}.apply(n,e))&&(t.exports=i),void 0!==t&&t.exports&&(t.exports=s),"object"==typeof window&&(!function(){var t=window.methods;s.ninja=function(){return window.methods=t,s}}(),window.methods=s)},function(t,n,o){(function(t){function n(t){this.bias="input"==t?0:.2*Math.random()-.1,this.squash=a.LOGISTIC,this.type=t||"hidden",this.activation=0,this.state=0,this.old=0,this.mask=1,this.connections={in:[],out:[],gated:[],self:new e(this,this,0)},this.error={responsibility:0,projected:0,gated:0}}t&&(t.exports=n);var e=o(4),i=o(1),s=o(5),r=o(3),a=i.Activation,c=i.Mutation;n.prototype={activate:function(t){if(void 0!==t)return this.activation=t,this.derivative=0,this.bias=0,this.activation;this.old=this.state,this.state=this.connections.self.gain*this.connections.self.weight*this.state+this.bias;for(var n in this.connections.in)n=this.connections.in[n],this.state+=n.from.activation*n.weight*n.gain;this.activation=this.squash(this.state)*this.mask,this.derivative=this.squash(this.state,!0);var o=[],e=[];for(var i in this.connections.gated){i=this.connections.gated[i];var s=i.to,r=o.indexOf(s);r>-1?e[r]+=i.weight*i.from.activation:(o.push(s),e.push(s.connections.self.gater==this?s.old:0),e[e.length-1]+=i.weight*i.from.activation)}for(var n in this.connections.in){n=this.connections.in[n],n.elegibility=this.connections.self.gain*this.connections.self.weight*n.elegibility+n.from.activation*n.gain;for(var a=0;a<o.length;a++){var s=o[a],c=e[a],r=n.xtrace.nodes.indexOf(s);r>-1?n.xtrace.values[r]=s.connections.self.gain*s.connections.self.weight*n.xtrace.values[r]+this.derivative*n.elegibility*c:(n.xtrace.nodes.push(s),n.xtrace.values.push(this.derivative*n.elegibility*c))}}for(var n in this.connections.gated)this.connections.gated[n].gain=this.activation;return this.activation},propagate:function(t,n){var o=0;if("output"==this.type)this.error.responsibility=this.error.projected=n-this.activation;else{for(var e in this.connections.out){var e=this.connections.out[e],i=e.to;o+=i.error.responsibility*e.weight*e.gain}this.error.projected=this.derivative*o,o=0;for(var s in this.connections.gated){s=this.connections.gated[s];var i=s.to,r=i.connections.self.gater==this?i.old:0;r+=s.weight*s.from.activation,o+=i.error.responsibility*r}this.error.gated=this.derivative*o,this.error.responsibility=this.error.projected+this.error.gated}if("constant"!=this.type){t=t||.1;for(var e in this.connections.in){for(var e=this.connections.in[e],a=this.error.projected*e.elegibility,c=0;c<e.xtrace.nodes.length;c++){var i=e.xtrace.nodes[c],h=e.xtrace.values[c];a+=i.error.responsibility*h}a*=this.mask,e.weight+=t*a}this.bias+=t*this.error.responsibility}},connect:function(t,o){var i=[];if(t instanceof s)for(var a=0;a<t.nodes.length;a++){var c=new e(this,t.nodes[a],o);t.nodes[a].connections.in.push(c),this.connections.out.push(c),t.connections.in.push(c),i.push(c)}else if(t instanceof n)if(t==this)0!=this.connections.self.weight?r.warnings&&console.warn("This connection already exists!"):this.connections.self.weight=o||1,i.push(this.connections.self);else{if(this.isProjectingTo(t))throw new Error("Already projecting a connection to this node!");var c=new e(this,t,o);t.connections.in.push(c),this.connections.out.push(c),i.push(c)}return i},disconnect:function(t,n){if(this==t)return void(this.connections.self.weight=0);for(var o in this.connections.out){var e=this.connections.out[o];if(e.to==t){this.connections.out.splice(o,1);var i=e.to.connections.in.indexOf(e);e.to.connections.in.splice(i,1),null!=e.gater&&this.ungate(e);break}}n&&t.disconnect(this)},gate:function(t){Array.isArray(t)||(t=[t]);for(var n in t)n=t[n],this.connections.gated.push(n),n.gater=this},ungate:function(t){Array.isArray(t)||(t=[t]);for(var n=t.length-1;n>=0;n--){var o=t[n],e=this.connections.gated.indexOf(o);this.connections.gated.splice(e,1),o.gater=null}},clear:function(){for(var t in this.connections.in)t=this.connections.in[t],t.elegibility=0,t.xtrace={nodes:[],values:[]};this.error.responsibility=this.error.projected=this.error.gated=0,this.old=this.state=this.activation=0},mutate:function(t){if(void 0===t)throw new Error("No mutate method given!");if(!t.name in i.Mutation)throw new Error("This method does not exist!");switch(t){case c.MOD_ACTIVATION:var n=t.allowed[(t.allowed.indexOf(this.squash)+Math.floor(Math.random()*(t.allowed.length-1))+1)%t.allowed.length];this.squash=n;break;case c.MOD_BIAS:var o=Math.random()*(t.max-t.min)+t.min;this.bias+=o}},isProjectingTo:function(t){for(conn in this.connections.out)if(conn=this.connections.out[conn],conn.to==t)return!0;return!1},isProjectedBy:function(t){for(conn in this.connections.in)if(conn=this.connections.in[conn],conn.from==t)return!0;return!1},toJSON:function(){return{bias:this.bias,type:this.type,squash:this.squash.name,mask:this.mask}}},n.fromJSON=function(t){var o=new n;o.bias=t.bias,o.type=t.type,o.mask=t.mask;for(squash in a)if(a[squash].name==t.squash){o.squash=a[squash];break}return o}}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={warnings:!0};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){(function(t){function n(t,n,o){this.from=t,this.to=n,this.gain=1,this.weight=void 0===o?.2*Math.random()-.1:o,this.gater=null,this.elegibility=0,this.xtrace={nodes:[],values:[]}}t&&(t.exports=n),n.prototype={toJSON:function(){return{weight:this.weight}}},n.innovationID=function(t,n){return.5*(t+n)*(t+n+1)+n}}).call(n,o(0)(t))},function(t,n,o){(function(t){function n(t){this.nodes=[],this.connections={in:[],out:[],self:[]};for(var n=0;n<t;n++)this.nodes.push(new i)}t&&(t.exports=n);var e=o(1),i=(o(4),o(2)),s=o(3);e.Activation,e.Mutation;n.prototype={activate:function(t){var n=[];if(void 0!==t&&t.length!=this.nodes.length)throw new Error("Array with values should be same as the amount of nodes!");for(var o=0;o<this.nodes.length;o++){if(void 0===t)var e=this.nodes[o].activate();else var e=this.nodes[o].activate(t[o]);n.push(e)}return n},propagate:function(t,n){if(void 0!==n&&n.length!=this.nodes.length)throw new Error("Array with values should be same as the amount of nodes!");for(var o=this.nodes.length-1;o>=0;o--)void 0===n?this.nodes[o].propagate(t):this.nodes[o].propagate(t,n[o])},connect:function(t,o,r){var a=[];if(t instanceof n){if(void 0===o&&(this!=t?(s.warnings&&console.warn("No group connection specified, using ALL_TO_ALL"),o=e.Connection.ALL_TO_ALL):(s.warnings&&console.warn("No group connection specified, using ONE_TO_ONE"),o=e.Connection.ONE_TO_ONE)),o==e.Connection.ALL_TO_ALL||o==e.Connection.ALL_TO_ELSE){for(var c=0;c<this.nodes.length;c++)for(var h=0;h<t.nodes.length;h++)if(o!=e.Connection.ALL_TO_ELSE||this.nodes[c]!=t.nodes[h]){var u=this.nodes[c].connect(t.nodes[h],r);this.connections.out.push(u[0]),t.connections.in.push(u[0]),a.push(u[0])}}else if(o==e.Connection.ONE_TO_ONE){if(this.nodes.length!=t.nodes.length)throw new Error("From and To group must be the same size!");for(var c=0;c<this.nodes.length;c++){var u=this.nodes[c].connect(t.nodes[c],r);this.connections.self.push(u[0]),a.push(u[0])}}}else if(t instanceof i)for(var c=0;c<this.nodes.length;c++){var u=this.nodes[c].connect(t,r);this.connections.out.push(u[0]),a.push(u[0])}return a},gate:function(t,n){if(void 0===n)throw new Error("Please specify Gating.INPUT, Gating.OUTPUT");Array.isArray(t)||(t=[t]);var o=[],i=[];for(var s in t)s=t[s],o.includes(s.from)||o.push(s.from),i.includes(s.to)||i.push(s.to);switch(n){case e.Gating.INPUT:for(var r=0;r<i.length;r++){var a=i[r],c=this.nodes[r%this.nodes.length];for(var h in a.connections.in)h=a.connections.in[h],t.includes(h)&&c.gate(h)}break;case e.Gating.OUTPUT:for(var r=0;r<o.length;r++){var a=o[r],c=this.nodes[r%this.nodes.length];for(var h in a.connections.out)h=a.connections.out[h],t.includes(h)&&c.gate(h)}break;case e.Gating.SELF:for(var r=0;r<o.length;r++){var a=o[r],c=this.nodes[r%this.nodes.length];t.includes(a.connections.self)&&c.gate(a.connections.self)}}},set:function(t){for(var n in this.nodes)void 0!==t.bias&&(this.nodes[n].bias=t.bias),this.nodes[n].squash=t.squash||this.nodes[n].squash,this.nodes[n].type=t.type||this.nodes[n].type},disconnect:function(t,o){if(o=o||!1,t instanceof n)for(var e=0;e<this.nodes.length;e++)for(var s=0;s<t.nodes.length;s++){this.nodes[e].disconnect(t.nodes[s],o);for(index in this.connections.out){var r=this.connections.out[index];if(r.from==this.nodes[e]&&r.to==t.nodes[s]){this.connections.out.splice(index,1);break}}if(o)for(index in this.connections.in){var r=this.connections.in[index];if(r.from==t.nodes[s]&&r.to==this.nodes[e]){this.connections.in.splice(index,1);break}}}else if(t instanceof i)for(var e=0;e<this.nodes.length;e++){this.nodes[e].disconnect(t,o);for(index in this.connections.out){var r=this.connections.out[index];if(r.from==this.nodes[e]&&r.to==t){this.connections.out.splice(index,1);break}}if(o)for(index in this.connections.in){var r=this.connections.in[index];if(r.from==t&&r.to==this.nodes[e]){this.connections.in.splice(index,1);break}}}},clear:function(){for(var t in this.nodes)this.nodes[t].clear()}}}).call(n,o(0)(t))},function(t,n,o){(function(t){function n(t,n){if(void 0===t||void 0===n)throw new Error("No input or output size given");this.input=t,this.output=n,this.nodes=[],this.connections=[],this.gates=[],this.selfconns=[],this.dropout=0;for(var o=0;o<this.input+this.output;o++){var i=o<this.input?"input":"output";this.nodes.push(new e(i,this.nodes.length))}for(var o=0;o<this.input;o++)for(var s=this.input;s<this.output+this.input;s++)this.connect(this.nodes[o],this.nodes[s])}t&&(t.exports=n);var e=o(2),i=o(4),s=o(1),r=o(3),a=o(7),c=(s.Activation,s.Mutation);n.prototype={activate:function(t,n){var o=[];for(node in this.nodes)if("input"==this.nodes[node].type)this.nodes[node].activate(t[node]);else if("output"==this.nodes[node].type){var e=this.nodes[node].activate();o.push(e)}else n&&(this.nodes[node].mask=Math.random()<this.dropout?0:1),this.nodes[node].activate();return o},propagate:function(t,n){this.nodes.reverse(),n.reverse();for(node in this.nodes)switch(this.nodes[node].type){case"hidden":this.nodes[node].propagate(t);break;case"output":this.nodes[node].propagate(t,n[node])}n.reverse(),this.nodes.reverse()},clear:function(){for(var t in this.nodes)this.nodes[t].clear()},connect:function(t,n){var o=t.connect(n);for(var e in o)e=o[e],t!=n?this.connections.push(e):this.selfconns.push(e);return o},disconnect:function(t,n){var o=t==n?this.selfconns:this.connections;for(conn in o){var e=o[conn];if(e.from==t&&e.to==n){null!=e.gater&&this.ungate(e),o.splice(conn,1);break}}t.disconnect(n)},gate:function(t,n){if(-1==this.nodes.indexOf(t))throw new Error("This node is not part of the network!");if(null!=n.gater)return void(r.warnings&&console.warn("This connection is already gated!"));t.gate(n),this.gates.push(n)},ungate:function(t){var n=this.gates.indexOf(t);if(-1==n)throw new Error("This connection is not gated!");this.gates.splice(n,1),t.gater.ungate(t)},remove:function(t){var n=this.nodes.indexOf(t);if(-1==n)throw new Error("This node does not exist in the network!");for(var o=[],e=[],i=t.connections.in.length-1;i>=0;i--){var r=t.connections.in[i];s.Mutation.SUB_NODE.keep_gates&&null!=r.gater&&r.gater!=t&&o.push(r.gater),e.push(r.from),this.disconnect(r.from,t)}for(var a=[],i=t.connections.out.length-1;i>=0;i--){var r=t.connections.out[i];s.Mutation.SUB_NODE.keep_gates&&null!=r.gater&&r.gater!=t&&o.push(r.gater),a.push(r.to),this.disconnect(t,r.to)}var c=[];for(var h in e){h=e[h];for(var u in a)if(u=a[u],!h.isProjectingTo(u)){var f=this.connect(h,u);c.push(f[0])}}for(var l in o){if(0==c.length)break;l=o[l];var d=Math.floor(Math.random()*c.length),f=c[d];this.gate(l,c[d]),c.splice(d,1)}for(var i=t.connections.gated.length-1;i>=0;i--){var f=t.connections.gated[i];this.ungate(f)}this.disconnect(t,t),this.nodes.splice(n,1)},mutate:function(t){if(void 0===t)throw new Error("No (correct) mutate method given!");switch(t){case c.ADD_NODE:var n=this.connections[Math.floor(Math.random()*this.connections.length)],o=n.gater;this.disconnect(n.from,n.to);var i=this.nodes.indexOf(n.to),s=new e("hidden",this.nodes.length);s.mutate(c.MOD_ACTIVATION);var a=Math.min(i,this.nodes.length-this.output);this.nodes.splice(a,0,s);var h=this.connect(n.from,s)[0],u=this.connect(s,n.to)[0];null!=o&&this.gate(o,Math.random()>=.5?h:u);break;case c.SUB_NODE:if(this.nodes.length==this.input+this.output){r.warnings&&console.warn("No more nodes left to remove!");break}var f=Math.floor(Math.random()*(this.nodes.length-this.output-this.input)+this.input);this.remove(this.nodes[f]);break;case c.ADD_CONN:for(var l=[],d=0;d<this.nodes.length-this.output;d++)for(var p=this.nodes[d],v=Math.max(d+1,this.input);v<this.nodes.length;v++){var g=this.nodes[v];p.isProjectingTo(g)||l.push([p,g])}if(0==l.length){r.warnings&&console.warn("No more connections to be made!");break}var m=l[Math.floor(Math.random()*l.length)];this.connect(m[0],m[1]);break;case c.SUB_CONN:var O=[];for(M in this.connections)M=this.connections[M],M.from.connections.out.length>1&&M.to.connections.in.length>1&&this.nodes.indexOf(M.to)>this.nodes.indexOf(M.from)&&O.push(M);if(0==O.length){r.warnings&&console.warn("No connections to remove!");break}var N=O[Math.floor(Math.random()*O.length)];this.disconnect(N.from,N.to);break;case c.MOD_WEIGHT:var n=this.connections[Math.floor(Math.random()*this.connections.length)],w=Math.random()*(t.max-t.min)+t.min;n.weight+=w;break;case c.MOD_BIAS:var f=Math.floor(Math.random()*(this.nodes.length-this.input)+this.input),s=this.nodes[f];s.mutate(t);break;case c.MOD_ACTIVATION:if(!t.mutateOutput&&this.input+this.output==this.nodes.length){r.warnings&&console.warn("No nodes that allow mutation of activation function");break}var f=Math.floor(Math.random()*(this.nodes.length-(t.mutateOutput?0:this.output)-this.input)+this.input),s=this.nodes[f];s.mutate(t);break;case c.ADD_SELF_CONN:for(var O=[],d=this.input;d<this.nodes.length;d++){var s=this.nodes[d];0==s.connections.self.weight&&O.push(s)}if(0==O.length){r.warnings&&console.warn("No more self-connections to add!");break}var s=O[Math.floor(Math.random()*O.length)];this.connect(s,s);break;case c.SUB_SELF_CONN:if(0==this.selfconns.length){r.warnings&&console.warn("No more self-connections to remove!");break}var M=this.selfconns[Math.floor(Math.random()*this.selfconns.length)];this.disconnect(M.from,M.to);break;case c.ADD_GATE:var _=this.connections.concat(this.selfconns),O=[];for(var M in _)M=_[M],null==M.gater&&O.push(M);if(0==O.length){r.warnings&&console.warn("No more connections to gate!");break}var s=this.nodes[Math.floor(Math.random()*this.nodes.length)],M=O[Math.floor(Math.random()*O.length)];this.gate(s,M);break;case c.SUB_GATE:if(0==this.gates.length){r.warnings&&console.warn("No more connections to ungate!");break}var f=Math.floor(Math.random()*this.gates.length),A=this.gates[f];this.ungate(A);break;case c.ADD_BACK_CONN:for(var l=[],d=this.input;d<this.nodes.length;d++)for(var p=this.nodes[d],v=this.input;v<d;v++){var g=this.nodes[v];p.isProjectingTo(g)||l.push([p,g])}if(0==l.length){r.warnings&&console.warn("No more connections to be made!");break}var m=l[Math.floor(Math.random()*l.length)];this.connect(m[0],m[1]);break;case c.SUB_BACK_CONN:var O=[];for(M in this.connections)M=this.connections[M],M.from.connections.out.length>1&&M.to.connections.in.length>1&&this.nodes.indexOf(M.from)>this.nodes.indexOf(M.to)&&O.push(M);if(0==O.length){r.warnings&&console.warn("No connections to remove!");break}var N=O[Math.floor(Math.random()*O.length)];this.disconnect(N.from,N.to);break;case c.SWAP_NODES:var f=Math.floor(Math.random()*(this.nodes.length-this.input)+this.input),p=this.nodes[f],f=Math.floor(Math.random()*(this.nodes.length-this.input)+this.input),g=this.nodes[f],T=p.bias,E=p.squash;p.bias=g.bias,p.squash=g.squash,g.bias=T,g.squash=E}},train:function(t,n){n=n||{},void 0===n.rate&&r.warnings&&console.warn("Using default learning rate, please define a rate!"),void 0===n.iterations&&r.warnings&&console.warn("No target iterations given, running until error is reached!");var o=Date.now(),e=n.log||!1,i=n.error||.005,a=n.cost||s.Cost.MSE,c=n.rate||.3,h=n.shuffle||!1,u=n.iterations||0,f=n.crossValidate||!1,l=n.clear||!1,d=n.dropout||0,p=n.schedule;if(this.dropout=d,f)var v=n.crossValidate.testSize,g=n.crossValidate.testError,m=Math.ceil((1-v)*t.length),O=t.slice(0,m),N=t.slice(m);var w=c,M=0;Array.isArray(c)&&(M=Math.floor(u/c.length));for(var _=0,A=1;A>i&&(0==u||_<u)&&!(f&&A<=g);){if(_++,"function"==typeof c&&(w=c(u,A)),A=0,M>0){w=c[Math.floor(u/M)]||w}if(f?(this._trainSet(O,w,a),l&&this.clear(),A+=this.test(N,a).error,l&&this.clear()):(A+=this._trainSet(t,w,a),l&&this.clear(),A/=t.length),h)for(var T,E,S=t.length;S;T=Math.floor(Math.random()*S),E=t[--S],t[S]=t[T],t[T]=E);e&&_%e==0&&console.log("iteration",_,"error",A,"rate",w),p&&_%p.iterations==0&&p.function()}if(l&&this.clear(),d)for(var S=0;S<this.nodes.length;S++)"hidden"!=this.nodes[S].type&&"constant"!=this.nodes[S].type||(this.nodes[S].mask=1-this.dropout);return{error:A,iterations:_,time:Date.now()-o}},_trainSet:function(t,n,o){var e=0;for(var i in t){var s=t[i].input,r=t[i].output,a=this.activate(s,!0);this.propagate(n,r),e+=o(r,a)}return e},test:function(t,n){n=n||s.Cost.MSE;var o,e,i,r=0,a=Date.now();for(var c in t)o=t[c].input,i=t[c].output,e=this.activate(o),r+=n(i,e);return r/=t.length,{error:r,time:Date.now()-a}},graph:function(t,n){var o=0,e=0,i={nodes:[],links:[],constraints:[{type:"alignment",axis:"x",offsets:[]},{type:"alignment",axis:"y",offsets:[]}]};for(a in this.nodes){var s=this.nodes[a];"input"==s.type?(1==this.input?i.constraints[0].offsets.push({node:a,offset:0}):i.constraints[0].offsets.push({node:a,offset:.8*t/(this.input-1)*o++}),i.constraints[1].offsets.push({node:a,offset:0})):"output"==s.type&&(1==this.output?i.constraints[0].offsets.push({node:a,offset:0}):i.constraints[0].offsets.push({node:a,offset:.8*t/(this.output-1)*e++}),i.constraints[1].offsets.push({node:a,offset:-.8*n})),i.nodes.push({id:a,name:"hidden"==s.type?s.squash.name:s.type.toUpperCase(),activation:s.activation,bias:s.bias})}var r=this.connections.concat(this.selfconns);for(connection in r)if(connection=r[connection],null==connection.gater)i.links.push({source:this.nodes.indexOf(connection.from),target:this.nodes.indexOf(connection.to),weight:connection.weight});else{var a=i.nodes.length;i.nodes.push({id:a,activation:connection.gater.activation,name:"GATE"}),i.links.push({source:this.nodes.indexOf(connection.from),target:a,weight:.5*connection.weight}),i.links.push({source:a,target:this.nodes.indexOf(connection.to),weight:.5*connection.weight}),i.links.push({source:this.nodes.indexOf(connection.gater),target:a,weight:connection.gater.activation,gate:!0})}return i},toJSON:function(){var t={nodes:[],connections:[],input:this.input,output:this.output,dropout:this.dropout};for(index in this.nodes){var n=this.nodes[index],o=n.toJSON();if(o.index=index,t.nodes.push(o),0!=n.connections.self.weight){var o=n.connections.self.toJSON();o.from=index,o.to=index,o.gater=null!=n.connections.self.gater?this.nodes.indexOf(n.connections.self.gater):null,t.connections.push(o)}}for(e in this.connections){var e=this.connections[e],o=e.toJSON();o.from=this.nodes.indexOf(e.from),o.to=this.nodes.indexOf(e.to),o.gater=null!=e.gater?this.nodes.indexOf(e.gater):null,t.connections.push(o)}return t},set:function(t){for(var n in this.nodes)this.nodes[n].bias=t.bias||this.nodes[n].bias,this.nodes[n].squash=t.squash||this.nodes[n].squash},evolve:function(t,n){function o(n){for(var o=0,s=0;s<i;s++)f&&n.clear(),o-=n.test(t,e).error;return o-=(n.nodes.length+n.connections.length+n.gates.length)*r,(o=isNaN(o)?-1/0:o)/i}var e=n.cost||s.Cost.MSE,i=n.amount||1,r=void 0!==n.growth?n.growth:1e-4,c=n.iterations||0,h=n.error||.005,u=n.log||0,f=n.clear||!1,l=n.schedule,d=Date.now();n.network=this;for(var p=new a(0,0,o,n),v=-1/0,g=-1/0,m=null;v<-h&&(0==c||p.generation<c);){p.evolve();var O=p.getFittest();f&&O.clear(),v=-O.test(t).error+(O.nodes.length+O.connections.length+O.gates.length)*r,v>g&&(g=v,m=O),u&&p.generation%u==0&&console.log("generation",p.generation,"error",O.score,"cost error",v),l&&iteration%l.iterations==0&&l.function()}f&&m.clear();var N={error:v,generations:p.generation,time:Date.now()-d};return this.nodes=m.nodes,this.connections=m.connections,this.gates=m.gates,this.selfconns=m.selfconns,N}},n.fromJSON=function(t){var o=new n(t.input,t.output);o.dropout=t.dropout,o.nodes=[],o.connections=[];for(node in t.nodes)o.nodes.push(e.fromJSON(t.nodes[node]));for(i in t.connections){var i=t.connections[i],s=o.connect(o.nodes[i.from],o.nodes[i.to])[0];s.weight=i.weight,null!=i.gater&&o.gate(o.nodes[i.gater],s)}return o},n.merge=function(t,o){if(t=n.fromJSON(t.toJSON()),o=n.fromJSON(o.toJSON()),t.output!=o.input)throw new Error("Output size of network1 should be the same as the input size of network2!");for(conn in o.connections)if(conn=o.connections[conn],"input"==conn.from.type){var e=o.nodes.indexOf(conn.from);o.nodes[e];conn.from=t.nodes[t.nodes.length-1-e]}for(var i=t.nodes.length-1-t.output;i<t.nodes.length;i++)t.nodes[i].type="hidden";return t.connections=t.connections.concat(o.connections),t.nodes=t.nodes.concat(o.nodes),t},n.crossOver=function(t,o,s){if(t.input!=o.input||t.output!=o.output)throw new Error("Networks don't have the same input/output size!");var r=new n(t.input,t.output);r.connections=[],r.nodes=[];var a=t.score||0,c=o.score||0;if(t=n.fromJSON(t.toJSON()),o=n.fromJSON(o.toJSON()),a==c)var h=Math.max(t.nodes.length,o.nodes.length),u=Math.min(t.nodes.length,o.nodes.length),f=Math.floor(Math.random()*(h-u+1)+u);else if(a>c)var f=t.nodes.length;else var f=o.nodes.length;for(var l=0;l<f;l++)if(l<t.nodes.length&&l<o.nodes.length){var d=null;if(l>=f-t.output)for(;null==d||"output"!=d.type;)d=Math.random()>=.5?t.nodes[l]:o.nodes[l];else for(;null==d||l<f-t.output&&"output"==d.type;)d=Math.random()>=.5?t.nodes[l]:o.nodes[l];r.nodes.push(d)}else l<t.nodes.length?l>=f-t.output?r.nodes.push(t.nodes[t.nodes.length-(l-(f-t.output-1))]):r.nodes.push(t.nodes[l]):l<o.nodes.length&&(l>=f-t.output?r.nodes.push(o.nodes[o.nodes.length-(l-(f-t.output-1))]):r.nodes.push(o.nodes[l]));for(d in r.nodes)r.nodes[d]=e.fromJSON(r.nodes[d].toJSON());var p={},v={},g=t.connections.concat(t.selfconns);for(m in g){var m=g[m],O={weight:m.weight,from:t.nodes.indexOf(m.from),to:t.nodes.indexOf(m.to),gater:t.nodes.indexOf(m.gater)};if(O.to==t.nodes.length-1){if(!(O.from<f-1))continue;O.to=f-1}var N=i.innovationID(O.from,O.to);p[N]=O}var w=o.connections.concat(o.selfconns);for(m in w){var m=w[m],O={weight:m.weight,from:o.nodes.indexOf(m.from),to:o.nodes.indexOf(m.to),gater:o.nodes.indexOf(m.gater)};if(O.to==o.nodes.length-1){if(!(O.from<f-1))continue;O.to=f-1}var N=i.innovationID(O.from,O.to);v[N]=O}var M={};for(var N in p)N in v&&(M[N]=[p[N],v[N]],delete p[N],delete v[N]);var _=[];for(m in M){var m=Math.random()>=.5?M[m][0]:M[m][1];_.push(m)}if(a==c){for(m in p)_.push(p[m]);for(m in v)_.push(v[m])}else if(a>c)for(m in p)_.push(p[m]);else for(m in v)_.push(v[m]);for(m in _){var A=_[m];if(A.to<f&&A.from<f){var T=r.nodes[A.from],E=r.nodes[A.to],m=r.connect(T,E)[0];m.weight=A.weight,-1!=A.gater&&A.gater<f&&r.gate(r.nodes[A.gater],m)}}return r}}).call(n,o(0)(t))},function(t,n,o){(function(t){function n(t,n,o,s){this.input=t,this.output=n,this.fitness=o,s=s||{},this.equal=s.equal||!1,this.popsize=s.popsize||50,this.elitism=s.elitism||0,this.mutationRate=s.mutationRate||.3,this.mutationAmount=s.mutationAmount||1,this.selection=s.selection||[i.Selection.FITNESS_PROPORTIONATE],this.crossover=s.crossover||[i.Crossover.SINGLE_POINT,i.Crossover.TWO_POINT,i.Crossover.UNIFORM,i.Crossover.AVERAGE],this.mutation=s.mutation||[i.Mutation.ADD_CONN,i.Mutation.SUB_CONN,i.Mutation.ADD_NODE,i.Mutation.SUB_NODE,i.Mutation.MOD_BIAS,i.Mutation.MOD_WEIGHT,i.Mutation.MOD_ACTIVATION],this.generation=0,this.createPool(s.network||new e(this.input,this.output))}t&&(t.exports=n);var e=(o(2),o(6)),i=o(1),s=(i.Activation,i.Mutation,i.Selection);i.Crossover;n.prototype={createPool:function(t){this.population=[];for(var n=0;n<this.popsize;n++){var o=e.fromJSON(t.toJSON());o.score=null,this.population.push(o)}},evolve:function(){null==this.population[this.population.length-1].score&&this.evaluate(),this.sort();for(var t=[],n=0;n<this.elitism;n++)t.push(this.population[n]);for(var n=0;n<this.popsize-this.elitism;n++)t.push(this.getOffspring());this.population=t,this.mutate();for(var n=0;n<this.population.length;n++)this.population[n].score=null;this.generation++},getOffspring:function(){parent1=this.getParent(),parent2=this.getParent(),1==this.equal&&(parent1.score=0,parent2.score=0);var t=this.crossover[Math.floor(Math.random()*this.crossover.length)];return e.crossOver(parent1,parent2,t)},mutate:function(){for(genome in this.population)if(Math.random()<=this.mutationRate)for(var t=0;t<this.mutationAmount;t++){var n=this.mutation[Math.floor(Math.random()*this.mutation.length)];this.population[genome].mutate(n)}},evaluate:function(){for(genome in this.population){var t=this.fitness(this.population[genome]);this.population[genome].score=t}},sort:function(){this.population.sort(function(t,n){return n.score-t.score})},getFittest:function(){return null==this.population[this.population.length-1].score&&this.evaluate(),this.sort(),this.population[0]},getAverage:function(){null==this.population[this.population.length-1].score&&this.evaluate();var t=0;for(genome in this.population)t+=this.population[genome].score;return t/this.popsize},getParent:function(){switch(this.selection[Math.floor(Math.random()*this.selection.length)]){case s.FITNESS_PROPORTIONATE:var t=Math.floor(s.FITNESS_PROPORTIONATE.config(Math.random())*this.popsize);return this.population[t]}},export:function(){var t=[];for(var n in this.population)n=this.population[n],t.push(n.toJSON());return t},import:function(t){var n=[];for(var o in t)o=t[o],n.push(e.fromJSON(o));this.population=n,this.popsize=n.length}}}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={LOGISTIC:function(t,o){if(!o)return 1/(1+Math.exp(-t));var e=n.LOGISTIC(t);return e*(1-e)},TANH:function(t,o){return o?1-Math.pow(n.TANH(t),2):Math.tanh(t)},IDENTITY:function(t,n){return n?1:t},STEP:function(t,n){return n?0:t>0?1:0},RELU:function(t,n){return n?t>0?1:0:t>0?t:0},SOFTSIGN:function(t,n){var o=1+Math.abs(t);return n?t/Math.pow(o,2):t/o},SINUSOID:function(t,n){return n?Math.cos(t):Math.sin(t)},GAUSSIAN:function(t,n){var o=Math.exp(-Math.pow(t,2));return n?-2*t*o:o},BENT_IDENTITY:function(t,n){var o=Math.sqrt(Math.pow(t,2)+1);return n?t/(2*o)+1:(o-1)/2+t},BIPOLAR:function(t,n){return n?0:t>0?1:-1},BIPOLAR_SIGMOID:function(t,n){var o=2/(1+Math.exp(-t))-1;return n?.5*(1+o)*(1-o):o},HARD_TANH:function(t,n){return n?t>-1&&t<1?1:0:Math.max(-1,Math.min(1,t))},ABSOLUTE:function(t,n){return n?t<0?-1:1:Math.abs(t)}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n=o(6),e=o(1),i=o(2),s=o(5),r={Construct:function(t){var o=new n(0,0),e=[];for(item in t)if(t[item]instanceof s)for(var r in t[item].nodes)e.push(t[item].nodes[r]);else t[item]instanceof i&&e.push(t[item]);for(var a=[],c=[],h=e.length-1;h>=0;h--)"output"==e[h].type||e[h].connections.out.length+e[h].connections.gated.length==0?(e[h].type="output",o.output++,c.push(e[h]),e.splice(h,1)):"input"!=e[h].type&&e[h].connections.in.length||(e[h].type="input",o.input++,a.push(e[h]),e.splice(h,1));if(e=a.concat(e).concat(c),0==o.input||0==o.output)throw new Error("Given nodes have no clear input/output node!");for(var r in e){for(var u in e[r].connections.out)o.connections.push(e[r].connections.out[u]);for(var u in e[r].connections.gated)o.gates.push(e[r].connections.gated[u]);0!=e[r].connections.self.weight&&o.selfconns.push(e[r].connections.self)}return o.nodes=e,o},Perceptron:function(){var t=Array.prototype.slice.call(arguments);if(t.length<3)throw new Error("not enough layers (minimum 3) !!");var n=[];n.push(new s(t[0]));for(var o=1;o<t.length;o++){var e=t[o],e=new s(e);n.push(e),n[o-1].connect(n[o])}return r.Construct(n)},Random:function(t,o,i,s){s=s||{};for(var r=s.connections||2*o,a=s.backconnections||0,c=s.selfconnections||0,h=s.gates||0,u=new n(t,i),f=0;f<o;f++)u.mutate(e.Mutation.ADD_NODE);for(var f=0;f<r-o;f++)u.mutate(e.Mutation.ADD_CONN);for(var f=0;f<a;f++)u.mutate(e.Mutation.ADD_BACK_CONN);for(var f=0;f<c;f++)u.mutate(e.Mutation.ADD_SELF_CONN);for(var f=0;f<h;f++)u.mutate(e.Mutation.ADD_GATE);return u},LSTM:function(){var t=Array.prototype.slice.call(arguments);if(t.length<3)throw new Error("not enough layers (minimum 3) !!");var n=t.pop();if("number"==typeof n){var o=new s(n);n={}}else var o=new s(t.pop());var i={};i.memoryToMemory=n.memoryToMemory||!1,i.outputToMemory=n.outputToMemory||!1,i.outputToGates=n.outputToGates||!1,i.inputToOutput=n.inputToOutput||!0;var a=new s(t.shift()),c=t,h=[];h.push(a);var u=null;for(var f in c){f=c[f];var l=new s(f),d=new s(f),p=new s(f),v=new s(f);l.set({bias:1}),d.set({bias:1}),v.set({bias:1});var g=a.connect(p);a.connect(l),a.connect(v),a.connect(d),p.connect(l),p.connect(d),p.connect(v);var m=p.connect(p),O=p.connect(o);l.gate(g,e.Gating.INPUT),d.gate(m,e.Gating.SELF),v.gate(O,e.Gating.OUTPUT),null!=u&&(u.connect(p),u.connect(l),u.connect(d),u.connect(v)),i.memoryToMemory&&p.connect(p,e.Connection.ALL_TO_ELSE),i.outputToMemory&&o.connect(p),i.outputToGates&&(o.connect(l),o.connect(d),o.connect(v)),h.push(l),h.push(d),h.push(p),h.push(v),u=p}return i.inputToOutput&&a.connect(o),h.push(o),r.Construct(h)},Hopfield:function(t){var n=new s(t),o=new s(t);return n.connect(o,e.Connection.ALL_TO_ALL),n.set({type:"input"}),o.set({squash:e.Activation.STEP,type:"output"}),new r.Construct([n,o])},NARX:function(t,n,o,i,a){Array.isArray(n)||(n=[n]);var c=[],h=new s(t);h.set({type:"input"});var u=new s(o);u.set({type:"output"});var f=[],l=new s(n[0]);f.push(l);for(var d=1;d<n.length;d++){var p=new s(n[d]);l.connect(p,e.Connection.ALL_TO_ALL),f.push(p),l=p}h.connect(f[0]),f[n.length-1].connect(u);for(var v=[],l=u,d=0;d<a;d++){var p=new s(o);p.set({squash:e.Activation.IDENTITY,bias:0,type:"constant"}),l.connect(p,e.Connection.ONE_TO_ONE,1),p.connect(f[0]),v.push(p),l=p}v.reverse();for(var g=[],l=h,d=0;d<i;d++){var p=new s(t);p.set({squash:e.Activation.IDENTITY,bias:0,type:"constant"}),l.connect(p,e.Connection.ONE_TO_ONE,1),p.connect(f[0]),g.push(p),l=p}return g.reverse(),c=c.concat(h),c=c.concat(v),c=c.concat(f),c=c.concat(g),c=c.concat(u),r.Construct(c)}};t&&(t.exports=r)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={ALL_TO_ALL:{name:"OUTPUT"},ALL_TO_ELSE:{name:"INPUT"},ONE_TO_ONE:{name:"SELF"}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={CROSS_ENTROPY:function(t,n){var o=0;for(var e in n)o-=t[e]*Math.log(Math.max(n[e],1e-15))+(1-t[e])*Math.log(1-Math.max(n[e],1e-15));return o},MSE:function(t,n){var o=0;for(var e in n)o+=Math.pow(t[e]-n[e],2);return o/n.length},BINARY:function(t,n){var o=0;for(var e in n)o+=Math.round(2*t[e])!=Math.round(2*n[e]);return o},MAE:function(t,n){var o=0;for(var e in n)o+=Math.abs(t[e]-n[e]);return o/n.length},MAPE:function(t,n){var o=0;for(var e in n)o+=Math.abs((n[e]-t[e])/Math.max(t[e],1e-15));return o/n.length},MSLE:function(t,n){var o=0;for(var e in n)o+=Math.log(Math.max(t[e],1e-15))-Math.log(Math.max(n[e],1e-15));return o},HINGE:function(t,n){var o=0;for(var e in n)o+=Math.max(0,1-t[e]*n[e]);return o}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={SINGLE_POINT:{name:"SINGLE_POINT",config:[.4]},TWO_POINT:{name:"TWO_POINT",config:[.4,.9]},UNIFORM:{name:"UNIFORM"},AVERAGE:{name:"AVERAGE"}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={OUTPUT:{name:"OUTPUT"},INPUT:{name:"INPUT"},SELF:{name:"SELF"}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n=o(8),e={ADD_NODE:{name:"ADD_NODE"},SUB_NODE:{name:"SUB_NODE",keep_gates:!0},ADD_CONN:{name:"ADD_CONN"},SUB_CONN:{name:"REMOVE_CONN"},MOD_WEIGHT:{name:"MOD_WEIGHT",min:-1,max:1},MOD_BIAS:{name:"MOD_BIAS",min:-1,max:1},MOD_ACTIVATION:{name:"MOD_ACTIVATION",mutateOutput:!0,allowed:[n.LOGISTIC,n.TANH,n.RELU,n.IDENTITY,n.STEP,n.SOFTSIGN,n.SINUSOID,n.GAUSSIAN,n.BENT_IDENTITY,n.BIPOLAR,n.BIPOLAR_SIGMOID,n.HARD_TANH,n.ABSOLUTE]},ADD_SELF_CONN:{name:"ADD_SELF_CONN"},SUB_SELF_CONN:{name:"SUB_SELF_CONN"},ADD_GATE:{name:"ADD_GATE"},SUB_GATE:{name:"SUB_GATE"},ADD_BACK_CONN:{name:"ADD_BACK_CONN"},SUB_BACK_CONN:{name:"SUB_BACK_CONN"},SWAP_NODES:{name:"SWAP_NODES"}};e.ALL=[e.ADD_NODE,e.SUB_NODE,e.ADD_CONN,e.SUB_CONN,e.MOD_WEIGHT,e.MOD_BIAS,e.MOD_ACTIVATION,e.ADD_GATE,e.SUB_GATE,e.ADD_SELF_CONN,e.SUB_SELF_CONN,e.ADD_BACK_CONN,e.SUB_BACK_CONN],e.FFW=[e.ADD_NODE,e.SUB_NODE,e.ADD_CONN,e.SUB_CONN,e.MOD_WEIGHT,e.MOD_BIAS,e.MOD_ACTIVATION],t&&(t.exports=e)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={FITNESS_PROPORTIONATE:{name:"FITNESS_PROPORTIONATE",config:function(t){return Math.pow(t,2)}}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){var e,i,s={Node:o(2),Neat:o(7),Network:o(6),Methods:o(1),Architect:o(9),Group:o(5),Connection:o(4),Config:o(3)};e=[],void 0!==(i=function(){return s}.apply(n,e))&&(t.exports=i),void 0!==t&&t.exports&&(t.exports=s),"object"==typeof window&&(!function(){var t=window.neataptic;s.ninja=function(){return window.neataptic=t,s}}(),window.neataptic=s)}])});