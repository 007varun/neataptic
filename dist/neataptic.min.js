/*!
 * The MIT License (MIT)
 * 
 * Copyright 2017 Thomas Wagenaar
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE
 * 
 */
!function(t){function n(i){if(o[i])return o[i].exports;var e=o[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var o={};n.m=t,n.c=o,n.i=function(t){return t},n.d=function(t,o,i){n.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(o,"a",o),o},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=13)}([function(t,n){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,n,o){var i,e,s={Activation:o(4),Mutation:o(11),Selection:o(12),Crossover:o(10),Cost:o(9)};i=[],void 0!==(e=function(){return s}.apply(n,i))&&(t.exports=e),void 0!==t&&t.exports&&(t.exports=s),"object"==typeof window&&(!function(){var t=window.methods;s.ninja=function(){return window.methods=t,s}}(),window.methods=s)},function(t,n,o){(function(t){function n(t){this.bias="input"==t?0:.2*Math.random()-.1,this.squash=e.LOGISTIC,this.type=t||"hidden",this.activation=0,this.connections={in:[],out:[]},this.error={responsibility:0,projected:0},this.trace={elegibility:{}}}t&&(t.exports=n);var i=o(1),e=i.Activation,s=i.Mutation;n.prototype={activate:function(t){if("input"==this.type)return this.activation=t,this.activation;this.state=this.bias;for(n in this.connections.in)this.state+=this.connections.in[n].from.activation*this.connections.in[n].weight;this.activation=this.squash(this.state),this.derivative=this.squash(this.state,!0);for(var n in this.connections.in){var t=this.connections.in[n];this.trace.elegibility[n]=t.from.activation}return this.activation},propagate:function(t,n){var o=0;if("output"==this.type)this.error.responsibility=this.error.projected=n-this.activation;else{for(var i in this.connections.out){var i=this.connections.out[i];o+=i.to.error.responsibility*i.weight}this.error.projected=this.derivative*o,this.error.responsibility=this.error.projected}t=t||.1;for(var i in this.connections.in){var e=this.connections.in[i],s=this.error.projected*this.trace.elegibility[i];e.weight+=t*s}this.bias+=t*this.error.responsibility},mutate:function(t){if(void 0===t)throw new Error("No mutate method given");switch(t){case s.MOD_ACTIVATION:for(var n=Math.floor(Math.random()*s.MOD_ACTIVATION.config.allowed.length);s.MOD_ACTIVATION.config.allowed[n]==this.squash;)n=Math.floor(Math.random()*s.MOD_ACTIVATION.config.allowed.length);this.squash=s.MOD_ACTIVATION.config.allowed[n]}},isProjectingTo:function(t){for(conn in this.connections.out)if(conn=this.connections.out[conn],conn.to==t)return!0;return!1},isProjectedBy:function(t){for(conn in this.connections.in)if(conn=this.connections.in[conn],conn.from==t)return!0;return!1},toJSON:function(){return{ID:this.ID,bias:this.bias,type:this.type,squash:this.squash.name}}},n.fromJSON=function(t){var o=new n;o.ID=t.ID,o.bias=t.bias,o.type=t.type;for(squash in e)if(e[squash].name==t.squash){o.squash=e[squash];break}return o}}).call(n,o(0)(t))},function(t,n,o){(function(t){function n(t,n){if(void 0===t||void 0===n)throw new Error("No input or output size given");this.input=t,this.output=n,this.nodes=[],this.connections=[];for(var o=0;o<this.input+this.output;o++){var e=o<this.input?"input":"output";this.nodes.push(new i(e,this.nodes.length))}for(var o=0;o<this.input;o++)for(var s=this.input;s<this.output+this.input;s++)this.connect(this.nodes[o],this.nodes[s])}t&&(t.exports=n);var i=o(2),e=o(8),s=o(1),r=s.Activation,a=s.Mutation;n.prototype={activate:function(t){var n=[];for(node in this.nodes)switch(this.nodes[node].type){case"input":this.nodes[node].activate(t[node]);break;case"hidden":this.nodes[node].activate();break;case"output":var o=this.nodes[node].activate();n.push(o)}return n},propagate:function(t,n){this.nodes.reverse();for(node in this.nodes)switch(this.nodes[node].type){case"hidden":this.nodes[node].propagate(t);break;case"output":this.nodes[node].propagate(t,n[node])}this.nodes.reverse()},connect:function(t,n){var o=new e(t,n);return this.connections.push(o),o.to.connections.in.push(o),o.from.connections.out.push(o),o},disconnect:function(t,n){for(conn in this.connections)if(this.connections[conn].from==t&&this.connections[conn].to==n){this.connections.splice(conn,1);break}for(conn in n.connections.in)if(n.connections.in[conn].from==t){n.connections.in.splice(conn,1);break}for(conn in t.connections.out)if(t.connections.out[conn].to==n){t.connections.out.splice(conn,1);break}},mutate:function(t){if(void 0===t)throw new Error("No mutate method given");switch(t){case a.ADD_NODE:var n=this.connections[Math.floor(Math.random()*this.connections.length)];this.disconnect(n.from,n.to);var o=this.nodes.indexOf(n.to),e=new i("hidden",this.nodes.length);e.mutate(a.MOD_ACTIVATION);var s=Math.min(o,this.nodes.length-this.output);this.nodes.splice(s,0,e),this.connect(n.from,e),this.connect(e,n.to);break;case a.REMOVE_NODE:if(this.nodes.length==this.input+this.output){console.warn("No more nodes left to remove!");break}for(var r=Math.floor(Math.random()*(this.nodes.length-this.output-this.input)+this.input),e=this.nodes[r],h=[],c=e.connections.in.length-1;c>=0;c--){var u=e.connections.in[c].from;h.push(u),this.disconnect(u,e)}for(var f=[],c=e.connections.out.length-1;c>=0;c--){var d=e.connections.out[c].to;f.push(d),this.disconnect(e,d)}for(var u in h){u=h[u];for(var d in f)d=f[d],u.isProjectingTo(d)||this.connect(u,d)}this.nodes.splice(r,1);break;case a.ADD_CONN:for(var p=0,l=0;l<this.nodes.length;l++)"input"==this.nodes[l].type?p+=this.nodes.length-this.input:"hidden"==this.nodes[l].type&&(p+=this.nodes.length-(l+1));if(p==this.connections.length){console.warn("Maximum amount of connections reached!");break}for(var v=!0;v;){v=!1;var m=Math.floor(Math.random()*(this.nodes.length-this.output)),g=this.nodes[m],s=Math.max(m+1,this.input),O=this.nodes[Math.floor(Math.random()*(this.nodes.length-s)+s)];for(c in this.connections)if(this.connections[c].from==g&&this.connections[c].to==O){v=!0;break}}this.connect(g,O);break;case a.MOD_WEIGHT:var n=this.connections[Math.floor(Math.random()*this.connections.length)],M=Math.random()*(a.MOD_WEIGHT.config.max-a.MOD_WEIGHT.config.min)+a.MOD_WEIGHT.config.min;n.weight+=M;break;case a.MOD_BIAS:var r=Math.floor(Math.random()*(this.nodes.length-this.input)+this.input),e=this.nodes[r],M=Math.random()*(a.MOD_BIAS.config.max-a.MOD_BIAS.config.min)+a.MOD_BIAS.config.min;e.bias+=M}},graph:function(t,n,o){var o=o||100,i=1,e=1,s={nodes:[],links:[],constraints:[{type:"alignment",axis:"x",offsets:[]},{type:"alignment",axis:"y",offsets:[]}]};for(index in this.nodes){var a=this.nodes[index],h="input"==a.type?0:"output"==a.type?1:a.squash==r.LOGISTIC?2:a.squash==r.TANH?3:a.squash==r.IDENTITY?4:a.squash==r.HLIM?5:a.squash==r.RELU?6:a.squash==r.SOFTSIGN?7:a.squash==r.SINUSOID?8:a.squash==r.GAUSSIAN?9:null;0==h?(s.constraints[0].offsets.push({node:index,offset:(t-o)/this.input*i}),s.constraints[1].offsets.push({node:index,offset:0}),i++):1==h&&(s.constraints[0].offsets.push({node:index,offset:(t-o)/(this.output+1)*e}),s.constraints[1].offsets.push({node:index,offset:-(n-o)/2}),e++),s.nodes.push({id:index,type:h})}for(connection in this.connections)connection=this.connections[connection],s.links.push({source:this.nodes.indexOf(connection.from),target:this.nodes.indexOf(connection.to),weight:connection.weight});return s},toJSON:function(){var t={nodes:[],connections:[],input:this.input,output:this.output};for(index in this.nodes){var n=this.nodes[index].toJSON();n.index=index,t.nodes.push(n)}for(o in this.connections){var o=this.connections[o],i=o.toJSON();i.from=this.nodes.indexOf(o.from),i.to=this.nodes.indexOf(o.to),t.connections.push(i)}return t}},n.fromJSON=function(t){var o=new n(t.input,t.output);o.nodes=[],o.connections=[];for(node in t.nodes)o.nodes.push(i.fromJSON(t.nodes[node]));for(e in t.connections){var e=t.connections[e],s=o.connect(o.nodes[e.from],o.nodes[e.to]);s.weight=e.weight,s.ID=e.id}return o},n.crossOver=function(t,o){if(t.input!=o.input||t.output!=o.output)throw new Error("Networks don't have the same input/output size!");var i=new n(t.input,t.output);i.connections=[],i.nodes=[];var s=t.score||0,r=o.score||0;if(t=n.fromJSON(t.toJSON()),o=n.fromJSON(o.toJSON()),s==r)var a=Math.max(t.nodes.length,o.nodes.length),h=Math.min(t.nodes.length,o.nodes.length),c=Math.floor(Math.random()*(a-h+1)+h);else if(s>r)var c=t.nodes.length;else var c=o.nodes.length;for(var u=0;u<c;u++)if(u<t.nodes.length&&u<o.nodes.length){var f=null;if(u>=c-t.output)for(;null==f||"output"!=f.type;)f=Math.random()>=.5?t.nodes[u]:o.nodes[u];else for(;null==f||u<c-t.output&&"output"==f.type;)f=Math.random()>=.5?t.nodes[u]:o.nodes[u];i.nodes.push(f)}else u<t.nodes.length?u>=c-t.output?i.nodes.push(t.nodes[t.nodes.length-(u-(c-t.output-1))]):i.nodes.push(t.nodes[u]):u<o.nodes.length&&(u>=c-t.output?i.nodes.push(o.nodes[o.nodes.length-(u-(c-t.output-1))]):i.nodes.push(o.nodes[u]));for(f in i.nodes)i.nodes[f].connections={in:[],out:[]};var d={},p={};for(l in t.connections){var l=t.connections[l],v={weight:l.weight,from:t.nodes.indexOf(l.from),to:t.nodes.indexOf(l.to)};if(v.to==t.nodes.length-1){if(!(v.from<c-1))continue;v.to=c-1}var m=e.innovationID(v.from,v.to);d[m]=v}for(l in o.connections){var l=o.connections[l],v={weight:l.weight,from:o.nodes.indexOf(l.from),to:o.nodes.indexOf(l.to)};if(v.to==o.nodes.length-1){if(!(v.from<c-1))continue;v.to=c-1}var m=e.innovationID(v.from,v.to);p[m]=v}var g={};for(var m in d)m in p&&(g[m]=[d[m],p[m]],delete d[m],delete p[m]);var O=[];for(l in g){var l=Math.random()>=.5?g[l][0]:g[l][1];O.push(l)}if(s==r){for(l in d)O.push(d[l]);for(l in p)O.push(p[l])}else if(s>r)for(l in d)O.push(d[l]);else for(l in p)O.push(p[l]);for(l in O){var M=O[l];if(M.to<c){var w=i.nodes[M.from],I=i.nodes[M.to],l=i.connect(w,I);l.weight=M.weight}}return i}}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={LOGISTIC:function(t,o){if(!o)return 1/(1+Math.exp(-t));var i=n.LOGISTIC(t);return i*(1-i)},TANH:function(t,o){return o?1-Math.pow(n.TANH(t),2):Math.tanh(t)},IDENTITY:function(t,n){return n?1:t},HLIM:function(t,n){return n?1:t>0?1:0},RELU:function(t,n){return n?t>0?1:0:t>0?t:0},SOFTSIGN:function(t,n){var o=1+Math.abs(t);return n?t/Math.pow(o,2):t/o},SINUSOID:function(t,n){return n?Math.cos(t):Math.sin(t)},GAUSSIAN:function(t,n){var o=Math.exp(-Math.pow(t,2));return n?-2*t*o:o}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n=o(3),i=(o(1),o(2)),e={Perceptron:function(){var t=Array.prototype.slice.call(arguments);if(t.length<3)throw new Error("not enough layers (minimum 3) !!");var o=t.shift(),e=t.pop(),s=t,r=new n(o,e);r.connections=[];for(var a in r.nodes)r.nodes[a].connections={in:[],out:[]};for(var h in s)for(var c=0;c<s[h];c++){var a=new i;r.nodes.splice(o,0,a)}var u=0,f=o;s.push(e);for(var h in s){for(var c=u;c<u+f;c++)for(var d=u+f;d<u+f+s[h];d++)r.connect(r.nodes[c],r.nodes[d]);u+=f,f=s[h]}return r}};t&&(t.exports=e)}).call(n,o(0)(t))},function(t,n,o){(function(t){function n(t,n,o,i){this.input=t,this.output=n,this.fitness=o,this.popsize=i.popsize||50,this.elitism=i.elitism||0,this.mutation=i.mutation||[s.ADD_NODE,s.ADD_CONN],this.selection=i.selection||[r.FITNESS_PROPORTIONATE],this.crossover=i.crossover||[a.UNIFORM],this.mutationRate=i.mutationRate||.3,this.generation=0,this.createPool()}t&&(t.exports=n);var i=(o(2),o(3)),e=o(1),s=(e.Activation,e.Mutation),r=e.Selection,a=e.Crossover;n.prototype={createPool:function(){this.population=[];for(var t=new i(this.input,this.output),n=0;n<this.popsize;n++){var o=i.fromJSON(t.toJSON());this.population.push(o)}},evolve:function(){this.evaluate(),this.sort();for(var t=[],n=0;n<this.elitism;n++)t.push(this.population[n]);for(var n=0;n<this.popsize-this.elitism;n++){var o=this.getParent(),e=this.getParent(),s=this.crossover[Math.floor(Math.random()*this.crossover.length)],r=i.crossOver(o,e,s);t.push(r)}for(genome in t)if(Math.random()<=this.mutationRate){var a=this.mutation[Math.floor(Math.random()*this.mutation.length)];t[genome].mutate(a)}this.population=t,this.generation++},evaluate:function(){for(genome in this.population){var t=this.fitness(this.population[genome]);this.population[genome].score=t}},sort:function(){this.population.sort(function(t,n){return n.score-t.score})},getFittest:function(){return void 0===this.population[this.population.length-1].score&&this.evaluate(),this.sort(),this.population[0]},getParent:function(){switch(this.selection[Math.floor(Math.random()*this.selection.length)]){case r.FITNESS_PROPORTIONATE:var t=Math.floor(r.FITNESS_PROPORTIONATE.config(Math.random())*this.popsize);return this.population[t]}}}}).call(n,o(0)(t))},function(t,n,o){(function(t){function n(t,n){n=n||{},this.network=t,this.rate=n.rate||.2,this.iterations=n.iterations||1e5,this.error=n.error||.005,this.cost=n.cost||null,this.crossValidate=n.crossValidate||null}t&&(t.exports=n);var i=o(1),e=i.Cost;n.prototype={train:function(t,n){function o(t){for(var n,o,i=t.length;i;n=Math.floor(Math.random()*i),o=t[--i],t[i]=t[n],t[n]=o);return t}var i,s,r,a=1,h=p=0,c=!1,u=n&&n.cost||this.cost||e.MSE,f=!1,d=Date.now();if(n&&(n.shuffle,n.iterations&&(this.iterations=n.iterations),n.error&&(this.error=n.error),n.rate&&(this.rate=n.rate),n.cost&&(this.cost=n.cost),n.schedule&&(this.schedule=n.schedule),(this.crossValidate||n.crossValidate)&&(this.crossValidate||(this.crossValidate={}),f=!0,n.crossValidate.testSize&&(this.crossValidate.testSize=n.crossValidate.testSize),n.crossValidate.testError&&(this.crossValidate.testError=n.crossValidate.testError))),i=this.rate,Array.isArray(this.rate))var p=Math.floor(this.iterations/this.rate.length);if(f){var l=Math.ceil((1-this.crossValidate.testSize)*t.length);r=t.slice(0,l),s=t.slice(l)}for(;!c&&h<this.iterations&&a>this.error&&!(f&&a<=this.crossValidate.testError);){if(h++,"function"==typeof this.rate&&(i=this.rate(h,a)),a=0,p>0){var v=Math.floor(h/p);i=this.rate[v]||i}f?(this._trainSet(r,i,u),a+=this.test(s).error):(a+=this._trainSet(t,i,u),a/=t.length),n&&(this.schedule&&this.schedule.every&&h%this.schedule.every==0?c=this.schedule.do({error:a,iterations:h,rate:i}):n.log&&h%n.log==0&&console.log("iterations",h,"error",a,"rate",i),n.shuffle&&o(t))}return{error:a,iterations:h,time:Date.now()-d}},trainAsync:function(t,n){var o=this.workerTrain.bind(this);return new Promise(function(i,e){try{o(t,i,n,!0)}catch(t){e(t)}})},_trainSet:function(t,n,o){var i=0;for(var e in t){var s=t[e].input,r=t[e].output,a=this.network.activate(s);this.network.propagate(n,r),i+=o(r,a)}return i},test:function(t,n){var o,i,s,r=0,a=n&&n.cost||this.cost||e.MSE,h=Date.now();for(var c in t)o=t[c].input,s=t[c].output,i=this.network.activate(o),r+=a(s,i);return r/=t.length,{error:r,time:Date.now()-h}},workerTrain:function(t,n,o,i){i||console.warn("Deprecated: do not use `workerTrain`, use `trainAsync` instead.");var e=this;this.network.optimized||this.network.optimize();var s=this.network.worker(this.network.optimized.memory,t,o);s.onmessage=function(t){switch(t.data.action){case"done":var i=t.data.message.iterations,r=t.data.message.error,a=t.data.message.time;e.network.optimized.ownership(t.data.memoryBuffer),n({error:r,iterations:i,time:a}),s.terminate();break;case"log":console.log(t.data.message);case"schedule":if(o&&o.schedule&&"function"==typeof o.schedule.do){(0,o.schedule.do)(t.data.message)}}},s.postMessage({action:"startTraining"})}}}).call(n,o(0)(t))},function(t,n,o){(function(t){function n(t,n){this.weight=.2*Math.random()-.1,this.from=t,this.to=n}t&&(t.exports=n),n.prototype={toJSON:function(){return{weight:this.weight,id:this.ID}}},n.innovationID=function(t,n){return.5*(t+n)*(t+n+1)+n}}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={CROSS_ENTROPY:function(t,n){var o=0;for(var i in n)o-=t[i]*Math.log(n[i]+1e-15)+(1-t[i])*Math.log(1+1e-15-n[i]);return o},MSE:function(t,n){var o=0;for(var i in n)o+=Math.pow(t[i]-n[i],2);return o/n.length},BINARY:function(t,n){var o=0;for(var i in n)o+=Math.round(2*t[i])!=Math.round(2*n[i]);return o}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={SINGLE_POINT:{name:"SINGLE_POINT",config:[.4]},TWO_POINT:{name:"TWO_POINT",config:[.4,.9]},UNIFORM:{name:"UNIFORM"},AVERAGE:{name:"AVERAGE"}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n=o(4),i={ADD_NODE:{name:"ADD_NODE"},REMOVE_NODE:{name:"REMOVE_NODE"},ADD_CONN:{name:"ADD_CONNECTION"},REMOVE_CONN:{name:"REMOVE_CONN"},MOD_WEIGHT:{name:"MOD_WEIGHT",config:{min:-1,max:1}},MOD_BIAS:{name:"MOD_BIAS",config:{min:-1,max:1}},MOD_ACTIVATION:{name:"MOD_ACTIVATION",config:{allowed:[n.LOGISTIC,n.TANH,n.RELU,n.IDENTITY,n.HLIM,n.SOFTSIGN,n.SINUSOID,n.GAUSSIAN]}}};t&&(t.exports=i)}).call(n,o(0)(t))},function(t,n,o){(function(t){var n={FITNESS_PROPORTIONATE:{name:"FITNESS_PROPORTIONATE",config:function(t){return Math.pow(t,2)}}};t&&(t.exports=n)}).call(n,o(0)(t))},function(t,n,o){var i,e,s={Node:o(2),Neat:o(6),Network:o(3),Methods:o(1),Architect:o(5),Trainer:o(7)};i=[],void 0!==(e=function(){return s}.apply(n,i))&&(t.exports=e),void 0!==t&&t.exports&&(t.exports=s),"object"==typeof window&&(!function(){var t=window.neataptic;s.ninja=function(){return window.neataptic=t,s}}(),window.neataptic=s)}]);